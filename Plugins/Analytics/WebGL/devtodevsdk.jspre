!function(){"use strict";function e(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}function t(e,t,s,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,s):i?i.value=s:t.set(e,s),s}"function"==typeof SuppressedError&&SuppressedError;const s="deviceId",r="previousDeviceId",i="userId",n="previousUserId",a="logLevel",o="trackingAvailability",h={0:"earned",1:"bought"},l="tester",u="cheater",c={CODE:"code",TIMESTAMP:"timestamp",SESSION_ID:"sessionId",IN_EXPERIMENTS:"inExperiments",LEVEL:"level",STEP:"step",NAME:"name",PARAMETERS:"parameters",SOCIAL_NETWORK:"socialNetwork",POST_REASON:"postReason",PRICE:"price",ORDER_ID:"orderId",PRODUCT_ID:"productId",CURRENCY_CODE:"currencyCode",PURCHASE_ID:"purchaseId",PURCHASE_TYPE:"purchaseType",PURCHASE_AMOUNT:"purchaseAmount",PURCHASE_PRICE:"purchasePrice",PURCHASE_PRICE_CURRENCY:"purchasePriceCurrency",OS_VERSION:"osVersion",OS:"os",UUID:"uuid",USER_AGENT:"userAgent",TIME_ZONE_OFFSET:"timeZoneOffset",DISPLAY_RESOLUTION:"displayResolution",SPENT:"spent",EARNED:"earned",BOUGHT:"bought",BALANCE:"balance",LENGTH:"length",CURRENCY_NAME:"currencyName",CURRENCY_AMOUNT:"currencyAmount",ACCRUAL_TYPE:"accrualType",CURRENCY_SOURCE:"currencySource",SOURCE:"source",DIFFICULTY:"difficulty",SUCCESSFUL_COMPLETION:"successfulCompletion",DURATION:"duration",TRACKING_ALLOWED:"trackingAllowed",UTM_SOURCE:"utm_source",UTM_MEDIUM:"utm_medium",UTM_CONTENT:"utm_content",UTM_CAMPAIGN:"utm_campaign",UTM_TERM:"utm_term",AD_NETWORK:"ad_network",AD_UNIT:"ad_unit",REVENUE:"revenue",PLACEMENT:"placement",IN_PROGRESS:"inProgress"},g={SP_CODE:"sp",SC_CODE:"sc",TR_CODE:"tr",RP_CODE:"rp",VP_CODE:"vp",DI_CODE:"di",CE_CODE:"ce",LU_CODE:"lu",UE_CODE:"ue",AL_CODE:"al",RF_CODE:"rf",SS_CODE:"ss",CA_CODE:"ca",PE_CODE:"pe",TS_CODE:"ts",PL_CODE:"pl",CB_CODE:"cb",ADRV_CODE:"adrv",CH_CODE:"ch",TSTR_CODE:"tstr"},d="payingUser",p=2147483647,m=-2147483647,f=Number.MAX_SAFE_INTEGER,v=Number.MIN_SAFE_INTEGER,E={NO:"No",ERROR:"Error",WARNING:"Warning",INFO:"Info",DEBUG:"Debug"},C="DevToDev",y="3.0.0",S="app",M="events",A="users",T="experiments",I="plugins";function b(e){return e&&(e=e.toString().trim()),e}function k(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}function D(e){return"number"==typeof e}function U(e){return"boolean"==typeof e}function w(e){return"string"==typeof e}function R(e){return null===e}function O(e){return new Promise(t=>setTimeout(t,e))}function P(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}const x={generateUUID:function(){const e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const s=(e+16*Math.random())%16|0;return("x"===t?s:3&s|8).toString(16)})},trimmer:b,parseUrlParams:function(e,t){e=decodeURIComponent(e),t=t.replace(/\[/,"\\[").replace(/\]/,"\\]");const s=new RegExp("[\\?&=]"+t+"=([^&#]*)").exec(e);return s&&"string"==typeof s[1]&&0!==s[1].length?decodeURIComponent(s[1].replace(/\+/g," ")):""},isEqual:function(e,t){if(null===e&&e===t)return!0;if(typeof e==typeof t)switch(typeof e){case"number":case"string":case"boolean":return e===t;case"object":if(Array.isArray(e)&&Array.isArray(t))return k(e,t);if(P(e)&&P(t))return JSON.stringify(e)===JSON.stringify(t)}return!1},isArrayEqual:k,isNullOrEmpty:function(e){if(void 0===e)return!0;if("function"==typeof e||"[object Date]"===Object.prototype.toString.call(e))return!1;if(D(e)||U(e))return null===e;if(null===e||0===b(e).length)return!0;if("object"==typeof e){for(const t in e)return!1;return!0}return!1},isNumber:D,isInteger:function(e){return"number"==typeof e&&parseInt(e.toString())===e},isBoolean:U,isString:w,isNull:R,isFunction:function(e){return"function"==typeof e},isObject:P,deepClone:function e(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(Array.isArray(t))return t.map(t=>e(t));if(P(t)){const s={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=e(t[r]));return s}return t},deepMerge:function e(t,...s){if(!s.length)return t;const r=s.shift();if(void 0===r)return t;if(P(t)&&P(r))for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&(P(r[s])?(t[s]||Object.assign(t,{[s]:{}}),e(t[s],r[s])):Object.assign(t,{[s]:r[s]}));return e(t,...s)},debounce:function(e,t,s=!1){let r=null;return function(...i){const n=s&&!r;r&&clearTimeout(r),r=setTimeout(()=>{r=null,s||e(...i)},t),n&&e(...i)}},throttle:function(e,t){let s;return function(...r){s||(e.apply(this,r),s=!0,setTimeout(()=>s=!1,t))}},randomString:function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let r=0;r<e;r++)s+=t.charAt(Math.floor(62*Math.random()));return s},formatBytes:function(e,t=2){if(0===e)return"0 Bytes";const s=t<0?0:t,r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(s))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r]},getTimestamp:function(){return Date.now()},getCurrentDate:function(){return(new Date).toISOString()},sleep:O,retry:async function(e,t=3,s=1e3){let r;for(let i=0;i<t;i++)try{return await e()}catch(e){if(r=e,i===t-1)throw r;const n=s*Math.pow(2,i);await O(n)}throw r},toSafeString:function(e){return w(e)?e:D(e)||U(e)?e.toString():R(e)?"":P(e)?JSON.stringify(e):String(e)},getPackagesByteSize:function(e){const t=JSON.stringify(e);return(new TextEncoder).encode(t).length}};const N=new class{format(e,t){return 1===t.length&&null!==t[0]&&"object"==typeof t[0]&&(t=t[0]),e.replace(/{([^}]*)}/g,(e,s)=>void 0!==t[s]?t[s]?t[s].toString():t[s]:e)}delNotValidChars(e){if("string"==typeof e)try{const t=new RegExp("\\p{C}","ug");e=e.replace(t,"")}catch{const t=/[\x00-\x1F\x7F-\x9F]/g;e=e.replace(t,"")}return e}};class _{constructor(e){this.level=E.NO,e?.level&&this.setLogLevel(e.level),e?.callback&&(this.callback=e.callback),e?.systemManager&&(this.systemManager=e.systemManager)}static getInstance(e){return _.instance||(_.instance=new _(e)),_.instance}setLogLevel(e){!x.isNullOrEmpty(e)&&Object.values(E).includes(e)?this.level=e:this.warning("Invalid log level: {type}. Available levels: [No, Error, Warning, Info, Debug]",{type:e})}getLogLevel(){return this.level}setCallback(e){this.callback=e}error(e,t){this.log("Error",e,t)}warning(e,t){this.log("Warning",e,t)}info(e,t){this.log("Info",e,t)}debug(e,t){this.log("Debug",e,t)}log(e,t,s){if(!this.level||this.level===E.NO)return;const r={[E.NO]:0,[E.ERROR]:1,[E.WARNING]:3,[E.INFO]:7,[E.DEBUG]:15};if(r[this.level]>=r[e]){let r=t;if(x.isNullOrEmpty(s)||(r=N.format(t,s)),this.callback)this.callback(e,r);else{const t=this.getDate(),s=this.systemManager?.getSdkVer()||y,i=`${t} [${C} ${s}] ${e} ${r}`;this.outputToConsole(e,i)}}}getDate(){const e=new Date,t=e.getDate(),s=e.getMonth()+1,r=e.getFullYear(),i=e.getHours(),n=e.getMinutes(),a=e.getSeconds(),o=e.getMilliseconds(),h=(e,t=2)=>{const s=e.toString().length;return(s<t?"0".repeat(t-s):"")+e};return`${r}/${h(s)}/${h(t)} ${h(i)}:${h(n)}:${h(a)}:${h(o,3)}`}outputToConsole(e,t){let s;switch(e){case E.ERROR:s=console.error;break;case E.WARNING:s=console.warn;break;case E.INFO:s=console.info;break;case E.DEBUG:s=console.log}s&&s(t)}}_.instance=null;const L=_.getInstance();var V,B,F,K,G,W,z,q,H,j,$;class Y{constructor(e){V.add(this),B.set(this,void 0),t(this,B,e,"f")}setTester(t){const s="setTester";try{e(this,B,"f").setUserCardField(l,t,s)}catch(t){e(this,V,"m",F).call(this,t,s)}}setCheater(t){const s="setCheater";try{e(this,B,"f").setUserCardField(u,t,s)}catch(t){e(this,V,"m",F).call(this,t,s)}}set(t,s){try{e(this,B,"f").setUserCardField(t,s,"set")}catch(t){e(this,V,"m",F).call(this,t,"set")}}getValue(t){const s="getValue";try{return e(this,B,"f").getUserCardField(s,t)}catch(t){e(this,V,"m",F).call(this,t,s)}}unset(t){const s="unset";try{e(this,B,"f").unsetUserCardFields(s,t)}catch(t){e(this,V,"m",F).call(this,t,s)}}clearUser(){try{e(this,B,"f").clearUserCard()}catch(t){e(this,V,"m",F).call(this,t,"clearUser")}}}B=new WeakMap,V=new WeakSet,F=function(e,t){null!==e&&L.error(t,{method:t}),L.error("Execution of the {method} method was canceled!",{method:t})},function(e){e.primaryId="0",e.primaryUserId="1",e.language="2",e.appVersion="3",e.sdkVersion="4",e.sdkCodeVersion="5",e.forced="6",e.params="7",e.code="8",e.engine="9"}(K||(K={})),function(e){e.userId="2",e.prevUserId="3",e.timeSentBalance="4",e.devtodevId="5",e.crossPlatformDevtodevId="6",e.created="7",e.lastForeground="8",e.sessionLength="9",e.sessionStarted="10",e.tutorialSteps="11",e.currentLevel="12",e.referralStatus="14",e.currencyAccrual="15",e.profile="16",e.updateProfile="17",e.isPayingUser="19",e.tracking="21",e.isDefault="22",e.backendAsk="23",e.lastActive="24",e.deviceId="25",e.userProperties="26",e.prevDeviceId="28",e.devtodevIdTimestamp="31",e.userCounting="1",e.newUser="32",e.activeExperiment="20",e.userExperiments="33",e.remoteConfigData="34",e.isMigrated="35"}(G||(G={})),function(e){e.experimentsVersion="0",e.experiments="1"}(W||(W={})),function(e){e.remoteVersion="0",e.remoteConfig="1",e.remoteConfigDefault="2",e.activeRemoteConfig="3",e.invalidated="4"}(z||(z={})),function(e){e.id="0",e.conditions="1",e.isTesting="2",e.parameters="3",e.creationDate="4",e.updateDate="5",e.completionDate="6",e.isRefused="8"}(q||(q={})),function(e){e.activeExperiment="3",e.refusedExperiments="4"}(H||(H={})),function(e){e.uuid="0",e.appVersion="1",e.transactionIds="2",e.config="4",e.isMigration="5"}(j||(j={})),function(e){e[e.Undefined=0]="Undefined",e[e.Defaults=1]="Defaults",e[e.Remote=2]="Remote",e[e.AbTest=3]="AbTest"}($||($={}));const Q={0:"undefined",1:"defaults",2:"remote",3:"abTest"};var J,X,Z,ee,te,se,re,ie,ne,ae;class oe{constructor(e,s){J.set(this,void 0),X.set(this,void 0),t(this,J,e,"f"),t(this,X,s,"f")}get stringValue(){return String(e(this,J,"f"))}get floatValue(){const t=parseFloat(e(this,J,"f"));return isNaN(t)?(L.error("Unable to parse value as Float."),0):t}get doubleValue(){const t=parseFloat(e(this,J,"f"));return isNaN(t)?(L.error("Unable to parse value as Double."),0):t}get longValue(){try{return String(BigInt(e(this,J,"f")))}catch(e){const t=e instanceof Error?e.message:"string"==typeof e?e:"";return L.error("Unable to parse value as Long: "+t),"0"}}get intValue(){const t=parseInt(e(this,J,"f"),10);return isNaN(t)?(L.error("Unable to parse value as Int."),0):t}get boolValue(){return Boolean(e(this,J,"f"))}get source(){return Q[e(this,X,"f")]}}J=new WeakMap,X=new WeakMap;class he{constructor(s,r={}){return Z.set(this,void 0),ee.set(this,void 0),t(this,Z,{...s},"f"),t(this,ee,{...r},"f"),new Proxy(this,{get(t,s){if("hasKey"===s)return t.hasKey.bind(t);if("values"===s)return t.values;if("string"==typeof s){const r=e(t,Z,"f")[s];return r?Array.isArray(r.value)&&0===r.value.length?e(t,ee,"f")[s]?new oe(e(t,ee,"f")[s]?.value,$.Defaults):new oe(void 0,$.Undefined):new oe(r.value,r.source):new oe(void 0,$.Undefined)}}})}get values(){return e(this,Z,"f")}hasKey(t){return void 0!==e(this,Z,"f")[t]}}Z=new WeakMap,ee=new WeakMap;class le{constructor(e){t(te,te,e,"f",se)}static resetConfig(){t(te,te,new he(e(te,te,"f",ne).values),"f",ae)}static invalidateConfig(){t(te,te,new he(e(te,te,"f",ne).values),"f",ae)}static applyConfig(s){t(te,te,new he(s,e(te,te,"f",ne).values),"f",ae)}set groupDefinitionWaiting(s){e(te,te,"f",se)?.getIsInitialized()?L.warning('[Remote Config] "groupDefinitionWaiting" can\'t be changed after SDK has been initialized'):(s=Number(s),isNaN(s)?L.warning('[Remote Config] "groupDefinitionWaiting" must be a number'):t(te,te,1e3*s,"f",re))}static get groupDefinitionWaiting(){return e(te,te,"f",re)/1e3}set defaults(e){const s={};Object.entries(e).forEach(([e,t])=>{s[e]={value:t,source:$.Defaults}}),t(te,te,new he(s,{}),"f",ne)}static get defaults(){return e(te,te,"f",ne)}get defaults(){return e(te,te,"f",ne)}static get config(){return e(te,te,"f",ae)?e(te,te,"f",ae):e(te,te,"f",ne)}get config(){return e(te,te,"f",ae)?e(te,te,"f",ae):e(te,te,"f",ne)}cacheTestExperiment(){t(te,te,!0,"f",ie)}static get cacheTestExperiment(){return e(te,te,"f",ie)}applyConfig(){e(te,te,"f",se)?.getIsInitialized()?e(te,te,"f",se)?.applyRemoteConfig():L.warning('[Remote Config] "applyConfig" can\'t be called before SDK has been initialized')}resetConfig(){e(te,te,"f",se)?.getIsInitialized()?e(te,te,"f",se)?.resetRemoteConfig():L.warning('[Remote Config] "resetConfig" can\'t be called before SDK has been initialized')}invalidateActiveConfig(){e(te,te,"f",se)?.getIsInitialized()?e(te,te,"f",se)?.invalidateRemoteConfig():L.warning('[Remote Config] "invalidateConfig" can\'t be called before SDK has been initialized')}}te=le,se={value:void 0},re={value:1e4},ie={value:!1},ne={value:new he({})},ae={value:null};const ue=new class{constructor(){this.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.lookup=new Uint8Array(256);for(let e=0;e<this.chars.length;e++)this.lookup[this.chars.charCodeAt(e)]=e}encode(e){return"undefined"!=typeof btoa?btoa(e):this.encodeFallback(e)}decode(e){return"undefined"!=typeof atob?atob(e):this.decodeFallback(e)}encodeFallback(e){let t="",s=0;for(;s<e.length;){const r=e.charCodeAt(s++)<<16|(s<e.length?e.charCodeAt(s++):0)<<8|(s<e.length?e.charCodeAt(s++):0);t+=this.chars[r>>18&63]+this.chars[r>>12&63]+this.chars[r>>6&63]+this.chars[63&r]}const r=e.length%3;return r>0&&(t=t.slice(0,r-3)+"===".slice(r)),t}decodeFallback(e){e=e.replace(/=+$/,"");let t="",s=0;for(;s<e.length;){const r=this.lookup[e.charCodeAt(s++)]<<18|this.lookup[e.charCodeAt(s++)]<<12|this.lookup[e.charCodeAt(s++)]<<6|this.lookup[e.charCodeAt(s++)];t+=String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(255&r)}return t}},ce=()=>"undefined"!=typeof window&&"CompressionStream"in window&&"DecompressionStream"in window;class ge{static detectOS(){return this.parseUserAgent()}static parseUserAgent(){const e="undefined"!=typeof navigator?navigator.userAgent:"",t=[{pattern:/Windows NT (\d+\.\d+)/,name:"Windows",versionMap:this.getWindowsVersionMap()},{pattern:/Mac OS X (\d+[._]\d+)/,name:"macOS",versionMap:this.getMacOSVersionMap()},{pattern:/iPhone OS (\d+[._]\d+)/,name:"iOS",versionMap:this.getIOSVersionMap()},{pattern:/Android (\d+\.\d+)/,name:"Android",versionMap:{}},{pattern:/Linux/,name:"Linux",versionMap:{}},{pattern:/CrOS/,name:"Chrome OS",versionMap:{}}];for(const{pattern:s,name:r,versionMap:i}of t){const t=e.match(s);if(t){return{name:r,version:t[1]?this.normalizeVersion(t[1],i):"unknown",platform:r.toLowerCase()}}}return{name:"unknown",version:"unknown",platform:"unknown"}}static normalizeVersion(e,t){const s=e.replace(/_/g,".");return t[s]||s}static getWindowsVersionMap(){return{"10.0":"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP x64",5.1:"XP","5.0":"2000"}}static getMacOSVersionMap(){return{"10_15":"10.15 Catalina","10_14":"10.14 Mojave","10_13":"10.13 High Sierra","10_12":"10.12 Sierra","10_11":"10.11 El Capitan","10_10":"10.10 Yosemite"}}static getIOSVersionMap(){return{"16_0":"16.0","15_0":"15.0","14_0":"14.0","13_0":"13.0","12_0":"12.0"}}}class de{static detectBot(e){if(null!==this.cachedResult)return this.cachedResult;if("undefined"==typeof navigator||"undefined"==typeof window)return this.cachedResult=!1,!1;const t=navigator.userAgent||"",s=this.isUnityEnvironment(t,e);if(!s&&this.checkUserAgentPatterns(t))return this.cachedResult=!0,!0;let r=[this.checkWebDriver(),this.checkAutomationFlags(),this.checkBrowserAPIs(),this.checkPerformanceTiming()].filter(e=>!0===e).length;const i=s?5:3;if(r>=i)return this.cachedResult=!0,!0;if(r+=[this.checkHeadlessBrowser(),this.checkPluginConsistency(),this.checkScreenConsistency(),this.checkLanguageTimezone()].filter(e=>!0===e).length,r>=i)return this.cachedResult=!0,!0;if(r<i){const e=[];e.push(this.checkCanvasFingerprint()),s||e.push(this.checkWebGLFingerprint()),r+=e.filter(e=>!0===e).length}return this.cachedResult=r>=i,this.cachedResult}static isUnityEnvironment(e,t){if("Unity"===t)return!0;const s=e.toLowerCase();if(s.includes("unity")||s.includes("unityweb")||s.includes("unity webgl"))return!0;try{if("undefined"!=typeof window&&(void 0!==window.unityWebGL||void 0!==window.Unity||void 0!==window.unityInstance))return!0}catch{}return!1}static clearCache(){this.cachedResult=null}static checkUserAgentPatterns(e){const t=e.toLowerCase();return/bot|crawler|spider|scraper|slurp|headless|phantom|selenium|webdriver|puppeteer|playwright|chromium|automation|googlebot|bingbot|duckduckbot|baiduspider|yandexbot|sogou|exabot|facebot|ia_archiver|facebookexternalhit|twitterbot|linkedinbot|whatsapp|telegrambot|discordbot|slackbot|ahrefs|semrush|mj12bot|dotbot|blexbot|petalbot|applebot|bingpreview|msnbot|adidxbot/i.test(t)}static checkWebDriver(){try{const e=navigator,t=window,s=document;return!!e.webdriver||(!(!t.__selenium_unwrapped&&!t.__selenium_evaluate)||(!!(t.__webdriver_evaluate||t.__driver_evaluate||t.__webdriver_script_fn||t.__driver_script_fn||t.__webdriver_script_func||t.__webdriver_script_function)||(!!(t.__fxdriver_evaluate||t.__driver_unwrapped||t.__selenium||t.calledSelenium||t.__selenium_unwrapped||t.__selenium_evaluate||t.__fxdriver_evaluate)||(!(!t.callPhantom&&!t._phantom)||(!!t.__nightmare||(!!t.__puppeteer_evaluation__||(!!t.__playwright||!!s.documentElement?.getAttribute?.("webdriver"))))))))}catch{return!1}}static checkHeadlessBrowser(){try{if(0===navigator.plugins.length){const e=navigator.userAgent;if(e.includes("Chrome")&&!e.includes("HeadlessChrome")&&(!navigator.languages||0===navigator.languages.length))return!0}if(!window.chrome&&navigator.userAgent.includes("Chrome"))return!0;return!!navigator.userAgent.toLowerCase().includes("headless")||(0===window.outerHeight&&0===window.outerWidth||!(!navigator.permissions||void 0!==navigator.permissions.query))}catch{return!1}}static checkBrowserAPIs(){try{const e=["navigator","window","document","screen","history","location"];for(const t of e)if(void 0===window[t])return!0;if(!navigator.userAgent||0===navigator.userAgent.length)return!0;if(!navigator.platform||0===navigator.platform.length)return!0;if(void 0!==navigator.hardwareConcurrency&&0===navigator.hardwareConcurrency)return!0;const t=navigator;return navigator.userAgent.includes("Chrome")&&t.deviceMemory,!1}catch{return!1}}static checkCanvasFingerprint(){try{const e=document.createElement("canvas");e.width=200,e.height=50;const t=e.getContext("2d");if(!t)return!0;t.fillStyle="#f60",t.fillRect(10,10,50,20),t.fillStyle="#069",t.font="12px Arial",t.fillText("Test",5,25);const s=e.toDataURL();return!s||s.length<100}catch{return!0}}static checkWebGLFingerprint(){try{const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return!1;if(!("getExtension"in t)||!("getParameter"in t)||"function"!=typeof t.getExtension||"function"!=typeof t.getParameter)return!1;const s=t,r=s.getExtension("WEBGL_debug_renderer_info");if(r){const e=s.getParameter(r.UNMASKED_VENDOR_WEBGL),t=s.getParameter(r.UNMASKED_RENDERER_WEBGL);if("string"==typeof t&&(t.includes("SwiftShader")||t.includes("Google SwiftShader")))return!0;if(!e||!t||"string"==typeof e&&0===e.length||"string"==typeof t&&0===t.length)return!0}return!1}catch{return!1}}static checkPerformanceTiming(){try{if(!window.performance||!window.performance.timing)return!1;const e=window.performance.timing,t=e.loadEventEnd-e.navigationStart;return t>0&&t<10||0===e.domContentLoadedEventEnd&&0===e.loadEventEnd&&0===e.responseEnd}catch{return!1}}static checkPluginConsistency(){try{if(0===navigator.plugins.length&&0===navigator.mimeTypes.length){const e=navigator.userAgent.toLowerCase();if(e.includes("chrome")&&!e.includes("headless"))return!0}return!1}catch{return!1}}static checkScreenConsistency(){try{if(window.screen){const e=window.screen.width,t=window.screen.height;if(0===e||0===t)return!0;if(e<100||t<100)return!0;if(window.outerWidth-window.innerWidth>2e3)return!0;window.screen.availWidth===window.screen.width&&(window.screen.availHeight,window.screen.height)}return!1}catch{return!1}}static checkLanguageTimezone(){try{const e=navigator;if(!navigator.language&&!e.userLanguage)return!0;try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone;if(!e||"UTC"===e)return!1}catch{return!0}return!1}catch{return!1}}static checkAutomationFlags(){try{const e=window,t=document;return!(!e.domAutomation&&!e.domAutomationController)||(e.chrome&&e.chrome.runtime,"Notification"in window&&void 0!==window.Notification&&"permission"in window.Notification&&window.Notification.permission,!(!t.$cdc_asdjflasutopfhvcZLmcfl_&&!t.$chrome_asyncScriptInfo))}catch{return!1}}}de.cachedResult=null;class pe{static detectDevice(e){const t="undefined"!=typeof navigator?navigator.userAgent:"";if(de.detectBot(e))return L.info("Bot detected. SDK will not be initialized and will not send events."),{type:"unknown",isBot:!0};const s=this.getDeviceType(t);return{type:s,isBot:!1,...this.getDeviceDetails(t,s)}}static getDeviceType(e){return/PlayStation|Xbox|Nintendo/i.test(e)?"console":/SmartTV|Tizen|WebOS|Roku|Chromecast/i.test(e)?"tv":/iPad|Android(?=.*\bMobile\b)(?=.*\bSafari\b)/i.test(e)?"tablet":/Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)?"mobile":"desktop"}static getDeviceDetails(e,t){if("mobile"===t||"tablet"===t){const t=e.match(/(iPhone|iPad|iPod|Samsung|Huawei|Xiaomi|OnePlus|Google|Sony|LG|Motorola|Nokia)/i),s=e.match(/\(([^)]+)\)/),r={};return t?.[1]&&(r.brand=t[1]),s?.[1]&&(r.model=s[1]),r}return{}}}class me{static detectBrowser(){const e="undefined"!=typeof navigator?navigator.userAgent:"";if("undefined"!=typeof navigator&&"userAgentData"in navigator){const t=navigator.userAgentData;if(t?.brands?.length&&t.brands.length>0){const s=t.brands[0];if(s)return{name:s.brand,version:s.version,engine:this.detectEngine(e)}}}return this.parseUserAgent(e)}static parseUserAgent(e){const t=[{pattern:/Chrome\/(\d+)/,name:"Chrome"},{pattern:/Firefox\/(\d+)/,name:"Firefox"},{pattern:/Safari\/(\d+)/,name:"Safari"},{pattern:/Edge\/(\d+)/,name:"Edge"},{pattern:/Opera\/(\d+)/,name:"Opera"}];for(const{pattern:s,name:r}of t){const t=e.match(s);if(t)return{name:r,version:t[1]||"unknown",engine:this.detectEngine(e)}}return{name:"unknown",version:"unknown",engine:"unknown"}}static detectEngine(e){return e.includes("Blink")?"Blink":e.includes("Gecko")?"Gecko":e.includes("WebKit")?"WebKit":e.includes("Trident")?"Trident":"unknown"}}class fe{static getLanguageISO639_1(){if("undefined"==typeof navigator)return"en";const e=navigator,t=navigator.language||e.userLanguage;return t&&t.split("-")[0]?.toLowerCase()||"en"}}class ve{static calculateDisplayResolution(){if("undefined"==typeof window)return"0x0";return`${window.screen?.width||window.innerWidth||0}x${window.screen?.height||window.innerHeight||0}`}}var Ee,Ce,ye,Se;class Me{constructor(s){Ee.add(this),Ce.set(this,void 0),ye.set(this,void 0),t(this,Ce,s,"f"),t(this,ye,new le(e(this,Ce,"f")),"f")}set logLevel(e){L.setLogLevel(e)}get logLevel(){return L.getLogLevel()}get user(){if(!e(this,Ce,"f"))throw new Error("Analytics is not initialized");return new Y(e(this,Ce,"f"))}get remoteConfig(){return e(this,ye,"f")}getAppVersion(){try{return e(this,Ce,"f").getter("appVer")}catch(t){e(this,Ee,"m",Se).call(this,t,"getAppVersion")}}setAppVersion(t){const s="setAppVersion";try{e(this,Ce,"f")?.setAppVer(s,t)}catch(t){e(this,Ee,"m",Se).call(this,t,s)}}getUserId(){try{return e(this,Ce,"f").getter("userId")}catch(t){e(this,Ee,"m",Se).call(this,t,"getUserId")}}setUserId(t){const s="setUserId";try{e(this,Ce,"f")?.setUserId(s,t)}catch(t){e(this,Ee,"m",Se).call(this,t,s)}}getCurrentLevel(){try{return e(this,Ce,"f").getter("level")}catch(t){e(this,Ee,"m",Se).call(this,t,"getCurrentLevel")}}setCurrentLevel(t){const s="setCurrentLevel";try{e(this,Ce,"f").setLevel(s,t)}catch(t){e(this,Ee,"m",Se).call(this,t,s)}}getTrackingAvailability(){try{return e(this,Ce,"f").getter("tracking")}catch(t){e(this,Ee,"m",Se).call(this,t,"getTrackingAvailability")}}setTrackingAvailability(t){const s="setTrackingAvailability";try{e(this,Ce,"f")?.setTracking(s,t)}catch(t){e(this,Ee,"m",Se).call(this,t,s)}}getDeviceId(){try{return e(this,Ce,"f").getter("deviceId")}catch(t){e(this,Ee,"m",Se).call(this,t,"getDeviceId")}}getSDKVersion(){try{return e(this,Ce,"f").getter("sdkVer")}catch(t){e(this,Ee,"m",Se).call(this,t,"getSDKVersion")}}socialNetworkConnect(t){const s="socialNetworkConnect";try{e(this,Ce,"f").addEvent(s,g.SC_CODE,{[c.SOCIAL_NETWORK]:t})}catch(t){e(this,Ee,"m",Se).call(this,t,s)}}socialNetworkPost(t,s){const r="socialNetworkPost";try{e(this,Ce,"f").addEvent(r,g.SP_CODE,{[c.SOCIAL_NETWORK]:t,[c.POST_REASON]:s})}catch(t){e(this,Ee,"m",Se).call(this,t,r)}}tutorial(t){const s="Tutorial";try{e(this,Ce,"f").addEvent(s,g.TR_CODE,{[c.STEP]:t})}catch(t){e(this,Ee,"m",Se).call(this,t,s)}}realCurrencyPayment(t,s,r,i){const n="realCurrencyPayment";try{e(this,Ce,"f").addEvent(n,g.RP_CODE,{[c.PRICE]:s,[c.ORDER_ID]:t,[c.PRODUCT_ID]:r,[c.CURRENCY_CODE]:i})}catch(t){e(this,Ee,"m",Se).call(this,t,n)}}virtualCurrencyPayment(t,s,r,...i){const n="virtualCurrencyPayment";try{const a={[c.PURCHASE_ID]:t,[c.PURCHASE_TYPE]:s,[c.PURCHASE_AMOUNT]:r};i.length>0&&(1===i.length&&"object"==typeof i[0]?a.r=i[0]:(a.p=i[0],a.c=i[1])),e(this,Ce,"f").addEvent(n,g.VP_CODE,a)}catch(t){e(this,Ee,"m",Se).call(this,t,n)}}customEvent(t,s){const r="customEvent";try{e(this,Ce,"f").addEvent(r,g.CE_CODE,{[c.NAME]:t,[c.PARAMETERS]:s})}catch(t){e(this,Ee,"m",Se).call(this,t,r)}}levelUp(t,s,r,i,n){const a="levelUp";try{e(this,Ce,"f").addEvent(a,g.LU_CODE,{[c.LEVEL]:t,[c.BOUGHT]:s,[c.BALANCE]:r,[c.SPENT]:i,[c.EARNED]:n})}catch(t){e(this,Ee,"m",Se).call(this,t,a)}}currencyAccrual(t,s,r,i){const n="currencyAccrual";try{e(this,Ce,"f").setCA(n,t,s,r,i)}catch(t){e(this,Ee,"m",Se).call(this,t,n)}}replaceUserId(t,s){const r="replaceUserId";try{e(this,Ce,"f").replaceUserId(r,t,s)}catch(t){e(this,Ee,"m",Se).call(this,t,r)}}startProgressionEvent(t,s){const r="startProgressionEvent";try{e(this,Ce,"f").startPe(r,t,s)}catch(t){e(this,Ee,"m",Se).call(this,t,r)}}finishProgressionEvent(t,s){const r="finishProgressionEvent";try{e(this,Ce,"f").stopPe(r,t,s)}catch(t){e(this,Ee,"m",Se).call(this,t,r)}}referrer(t){const s="referrer";try{e(this,Ce,"f").addEvent(s,g.RF_CODE,t)}catch(t){e(this,Ee,"m",Se).call(this,t,s)}}sendBufferedEvents(){try{e(this,Ce,"f").sendEvents()}catch(t){e(this,Ee,"m",Se).call(this,t,"sendBufferedEvents")}}setIdentifiersListener(t){try{e(this,Ce,"f").setCallbackDId(t)}catch(t){e(this,Ee,"m",Se).call(this,t,"setIdentifiersListener")}}adImpression(t,s,r,i){const n="adImpression";try{e(this,Ce,"f").addEvent(n,g.ADRV_CODE,{[c.AD_NETWORK]:t,[c.AD_UNIT]:i,[c.REVENUE]:s,[c.PLACEMENT]:r})}catch(t){e(this,Ee,"m",Se).call(this,t,n)}}onDebugMessage(e){L.setCallback(e)}testLogs(){L.error("this is error message"),L.warning("this is warning message"),L.info("this is info message"),L.debug("this is debug message")}currentBalance(t){const s="currentBalance";try{e(this,Ce,"f").addEvent(s,g.CB_CODE,t)}catch(t){e(this,Ee,"m",Se).call(this,t,s)}}setInitializationCompleteCallback(e){x.isFunction(e)?Me.onInitCallback=e:L.error("The parameter {method} must be a function",{method:"setInitializationCompleteCallback"})}registerPlugin(t){e(this,Ce,"f").pluginManager.register(t)}unregisterPlugin(t){e(this,Ce,"f").pluginManager.unregister(t)}}Ce=new WeakMap,ye=new WeakMap,Ee=new WeakSet,Se=function(e,t){null!==e&&(e instanceof Error?L.error(e.message,{method:t}):L.error(e,{method:t})),L.error("Execution of the {method} method was canceled!",{method:t})},Me.onInitCallback=null;const Ae="{arg} is [{cType}], but must be [{nType}]",Te="In the {method} method error has occurred: ";class Ie{constructor(){this.logger=_.getInstance(),this.transformer=N,this.helper=x}throw(e,t,s=!0){if(s)throw new Error(this.transformer.format(e,t));this.logger.error(Te+e,t)}validNotNullOrEmpty(e,t,s,r=!0,i=!0){const n=!this.helper.isNullOrEmpty(s),a={arg:t,method:e};if(!n){let e="{arg} is empty!";this.helper.isNull(s)&&(e="{arg} is null!"),(i||r)&&this.throw(e,a,r)}return n}validString(e,t,s,r=!0,i=!0){const n={arg:t,method:e,nType:"string"},a=this.validNotNullOrEmpty(e,t,s,r,i);if(a){if(!("string"==typeof s))return n.cType=typeof s,this.throw(Ae,n,r),!1}return a}validBoolean(e,t,s,r=!0){const i="boolean"==typeof s;return i||this.throw(Ae,{method:e,arg:t,nType:"boolean",cType:typeof s},r),i}validMinMaxNumber(e,t,s,r,i,n=!0){const a={arg:t,method:e,val:s,min:r,max:i};let o=!0,h="";return s<r&&(a.val=s,a.min=r,h="{arg} [{val}] is less than the min [{min}] permitted value!",o=!1),o&&s>i&&(a.val=s,a.max=i,h="{arg} [{val}] is greater than the max [{max}] permitted value!",o=!1),o||this.throw(h,a,n),o}validNumberNotNaN(e,t,s,r=!0){const i=!isNaN(s),n={arg:t,method:e};return i||this.throw("{arg} is the NaN.",n,r),i}validMinMaxDouble(e,t,s,r,i,n=!0){const a={arg:t,method:e,nType:"number"};let o="number"==typeof s;return o?(o=o&&this.validNumberNotNaN(e,t,s,n),o=o&&this.validMinMaxNumber(e,t,s,r,i,n),o):(a.cType=typeof s,this.throw(Ae,a,n),!1)}validMinMaxInteger(e,t,s,r,i,n=!0){const a={arg:t,method:e,nType:"integer"};let o=Number.isInteger(s);return o?(o=o&&this.validNumberNotNaN(e,t,s,n),o=o&&this.validMinMaxNumber(e,t,s,r,i,n),o):(a.cType=typeof s,this.throw(Ae,a,n),!1)}trimString(e,t,s,r){const i=s.substring(0,r);return i!==s&&this.logger.warning(Te+'{arg}: {value} is longer than it is permitted. The string was truncated to length "{maxLn}"!',{method:e,arg:t,maxLn:r,value:s}),i}equalStringLength(e,t,s,r,i=!0){const n=s.length===r,a={arg:t,method:e,size:r};return n||this.throw("{arg} Parameter length must be equal to [{size}]!",a,i),n}validBundle(e,t){return this.helper.isNullOrEmpty(e)?(this.throw("{method} has empty arguments!",{method:t},!0),!1):"object"==typeof e&&!Array.isArray(e)||(this.throw(Ae,{method:t,arg:"Arguments",nType:"object",cType:typeof e},!0),!1)}validCustomEvent(e,t,s={}){const r="The custom event name",i=this.transformer.delNotValidChars(e[c.NAME]||""),n=e[c.PARAMETERS]||{};let a=0;const o="The key of the parameters dictionary",h={};let l=!1;const u=void 0!==s.maxCeParams?s.maxCeParams:10;if(this.validString(t,r,i)){const s=this.trimString(t,r,i,72);e[c.NAME]=s}return Object.entries(n).forEach(([e,s])=>{if(a<u){const r=this.transformer.delNotValidChars(e);let i=!1;const n=this.transformer.format("The value of the parameters dictionary by [{trimKey}] key",{trimKey:r});let a=s;if(this.validString(t,o,r,!1)&&this.validNotNullOrEmpty(t,n,a,!1)){const e=this.trimString(t,o,r,32);"number"==typeof s?i=this.validMinMaxDouble(t,n,s,v,f,!1):"boolean"==typeof s?i=!0:"string"==typeof s?(a=this.transformer.delNotValidChars(s),i=this.validString(t,n,a,!1),i&&(a=this.trimString(t,o,a,255))):this.throw(Ae,{arg:n,method:t,cType:typeof a,nType:"boolean, integer, number, string"},!1),i&&(h[e]=a,l=!0)}}a++}),delete e[c.PARAMETERS],l&&(e[c.PARAMETERS]=h,a>u&&this.logger.error("[CustomEventParameters] Limit reached [{amount}] when adding a new parameter",{amount:u})),e}validReferrer(e,t="Referrer"){const s=["source","medium","content","campaign","term"],r={};if(this.validBundle(e,t)){for(let i=s.length-1;i>=0;i--){const n=s[i];if(void 0!==e[n]){const s=this.transformer.delNotValidChars(e[n]),i="The value of the utm data dictionary by ["+n+"] key";if(this.validString(t,i,s,!1)){const e=this.trimString(t,i,s,255);r[n]=e}}}this.helper.isNullOrEmpty(r)&&this.throw("{method} has empty Resources dictionary!",{method:t},!0)}return r}validSocialConnect(e,t){const s="The social network name argument value",r=this.transformer.delNotValidChars(e[c.SOCIAL_NETWORK]||"");return this.validString(t,s,r)&&(e[c.SOCIAL_NETWORK]=this.trimString(t,s,r,24)),e}validSocialPost(e,t){const s="The social network name argument value",r=this.transformer.delNotValidChars(e[c.SOCIAL_NETWORK]||""),i="The post reason argument value",n=this.transformer.delNotValidChars(e[c.POST_REASON]||"");return this.validString(t,s,r)&&(e[c.SOCIAL_NETWORK]=this.trimString(t,s,r,24)),this.validString(t,i,n)&&(e[c.POST_REASON]=this.trimString(t,i,n,32)),e}validTutorial(e,t,s={}){const r=e[c.STEP]||0;if(this.validMinMaxInteger(t,"The step argument value",r,m,p),r<1&&-1===[0,-1,-2].indexOf(r)&&this.throw("A tutorial step can include only predefined values: 0(Skipped), -1(Start), -2(Finish), and it can also be a positive integer",{method:t}),void 0!==s.steps&&-1!==s.steps.indexOf(r))throw this.logger.info("This tutorial step({step}) has already been sent. Skipped",{step:r}),null;return e}validRealCurrencyPayment(e,t,s={}){const r="The order id argument value",i="The price argument value",n="The product id parameter value",a="The currency code parameter value",o=this.transformer.delNotValidChars(e[c.ORDER_ID]||""),h=e[c.PRICE]||0,l=this.transformer.delNotValidChars(e[c.PRODUCT_ID]||""),u=this.transformer.delNotValidChars(e[c.CURRENCY_CODE]||"");if(this.validNotNullOrEmpty(t,i,h),this.validMinMaxDouble(t,i,h,v,f),this.validString(t,r,o)){const s=this.trimString(t,r,o,65);e[c.ORDER_ID]=s}if(this.validString(t,n,l)&&(e[c.PRODUCT_ID]=this.trimString(t,n,l,255)),this.validString(t,a,u)&&this.equalStringLength(t,a,u,3),void 0!==s.trIds&&-1!==s.trIds.indexOf(e[c.ORDER_ID]))throw this.logger.info("This order({order}) has already been sent. Skipped",{order:o}),null;return e}validVirtualCurrencyPayment(e,t){const s="The purchase identifier",r="The purchase type",i="The purchase amount",n=e[c.PURCHASE_AMOUNT]||0,a=this.transformer.delNotValidChars(e[c.PURCHASE_ID]||""),o=this.transformer.delNotValidChars(e[c.PURCHASE_TYPE]||""),h={[c.PURCHASE_AMOUNT]:n};return this.validNotNullOrEmpty(t,i,n),this.validMinMaxInteger(t,i,n,1,p),this.validString(t,s,a)&&(h[c.PURCHASE_ID]=this.trimString(t,s,a,32)),this.validString(t,r,o)&&(h[c.PURCHASE_TYPE]=this.trimString(t,r,o,96)),h}validCurrencyBalance(e,t){const s=this.validateResources(t,"balance",e,24,v,f);return this.helper.isNullOrEmpty(s)&&this.throw("balance is empty!",{method:t},!0),s}validLevelUp(e,t){const s=e[c.LEVEL]||0;return this.validMinMaxInteger(t,"The level argument value",s,1,2147483646),e}validAdImpression(e,t){const s="The network argument value",r="The placement argument value",i="The unit argument value",n=this.transformer.delNotValidChars(e[c.AD_NETWORK]||""),a=e[c.REVENUE]||0,o=this.transformer.delNotValidChars(e[c.PLACEMENT]||""),h=this.transformer.delNotValidChars(e[c.AD_UNIT]||""),l={source:"sdk"};return this.validString(t,s,n)&&(l[c.AD_NETWORK]=this.trimString(t,s,n,100)),this.validString(t,r,o,!1,!1)&&(l[c.PLACEMENT]=this.trimString(t,r,o,100)),this.validString(t,i,h,!1,!1)&&(l[c.AD_UNIT]=this.trimString(t,i,h,100)),this.validMinMaxDouble(t,"The revenue argument value",a,0,f)&&(l[c.REVENUE]=a),l}validPeople(e,t){const s="The people name argument value",r=this.transformer.delNotValidChars(e[c.NAME]||"");return this.validString(t,s,r)&&(e[c.NAME]=this.trimString(t,s,r,255)),e}validPlKey(e,t,s=!0){let r=this.transformer.delNotValidChars(t);const i="The key argument";if(this.validString(e,i,r,s)){switch(r=this.trimString(e,i,r,64),r.toLowerCase()){case l:case u:r=r.toLowerCase()}return r}return null}validPlVal(e,t,s){const r="The value argument";let i=null;const n={arg:r};switch(this.helper.isNullOrEmpty(s)&&this.throw("{arg} is empty!",n,!0),t){case l:case u:this.helper.isBoolean(s)||this.throw("Invalid value! The [{value}] value of the reserved key [{key}] must be Boolean",{key:t,value:s},!0)}return["string","number","boolean"].includes(typeof s)?this.helper.isNumber(s)?this.validMinMaxDouble(e,r,s,v,f)&&(i=s):this.helper.isBoolean(s)?i=s:(i=this.transformer.delNotValidChars(s),this.helper.isNullOrEmpty(i)&&this.throw("{arg} is empty!",n,!0),i=this.trimString(e,r,i,255)):(n.nType="number, string or boolean",n.cType=typeof i,this.throw(Ae,n,!0)),i}validCA(e,t,s,r,i,n){const a="The currency name",o="The currency amount",l="The source",u=this.transformer.delNotValidChars(t),g=this.transformer.delNotValidChars(r),d={};this.validString(e,a,u)&&(d[c.CURRENCY_NAME]=this.trimString(e,a,u,24)),this.validString(e,l,g)&&(d[c.CURRENCY_SOURCE]=this.trimString(e,l,g,32)),this.validNotNullOrEmpty(e,o,s)&&this.validMinMaxInteger(e,o,s,1,Number.MAX_SAFE_INTEGER)&&(d[c.CURRENCY_AMOUNT]=s);const p=/^\d+$/.test(i.toString())&&i>1;return[0,1].includes(i)||p?d[c.ACCRUAL_TYPE]=i:this.throw("Accrual type can include only predefined values: 0(earned), 1(bought), and it can also be a positive value",{method:e},!0),n&&n[h[i]]&&n[h[i]][g]&&void 0!==n[h[i]][g][u]&&n[h[i]][g][u]+s>Number.MAX_SAFE_INTEGER&&this.throw("{amountArg} is overflowed",{amountArg:o,method:e},!0),d}validStartPe(e,t,s){const r="The event name argument value",i="The source parameter value";let n=this.transformer.delNotValidChars(t);const a={};if(this.validString(e,r,n)&&(n=this.trimString(e,r,n,40)),!this.helper.isNullOrEmpty(s)){if(void 0!==s[c.SOURCE]){const t=this.transformer.delNotValidChars(s[c.SOURCE]||"");this.validString(e,i,t)&&(a[c.SOURCE]=this.trimString(e,i,t,40))}void 0!==s[c.DIFFICULTY]&&this.validMinMaxInteger(e,"The difficulty parameter value",s[c.DIFFICULTY],m,p)&&(a[c.DIFFICULTY]=s[c.DIFFICULTY])}return{name:n,bundle:a}}validStopPe(e,t,s){const r="The event name argument value",i=this.transformer.delNotValidChars(t),n={name:i,parameters:s};return this.validString(e,r,i)&&(n.name=this.trimString(e,r,i,40)),this.helper.isNullOrEmpty(s)||(void 0!==s[c.DURATION]&&this.validMinMaxInteger(e,"The duration parameter value",s[c.DURATION]||0,0,p)&&(n[c.PARAMETERS][c.DURATION]=s[c.DURATION]),void 0!==s[c.SUCCESSFUL_COMPLETION]&&this.validBoolean(e,"The success parameter value",s[c.SUCCESSFUL_COMPLETION],!0)&&(n[c.PARAMETERS][c.SUCCESSFUL_COMPLETION]=s[c.SUCCESSFUL_COMPLETION]),[{code:c.EARNED,arg:"Earn",dictName:"earn dictionary"},{code:c.SPENT,arg:"Spent",dictName:"spent dictionary"}].forEach(({code:t,arg:r,dictName:i})=>{if(void 0!==s[t]){const a=this.validateResources(e,i,s[t],24,1,f);this.helper.isNullOrEmpty(a)?this.throw("{arg} dictionary is empty !",{method:e,arg:r},!1):n[c.PARAMETERS][t]=a[t]}})),n}validateResources(e,t,s,r,i,n){const a={};return Object.entries(s).forEach(([s,o])=>{const h=this.transformer.delNotValidChars(s),l="The ["+h+"] key of the "+t,u="The value of the "+t;if(this.validString(e,l,h,!1)){const t=this.trimString(e,l,h,r);this.validMinMaxInteger(e,u,o,i,n,!1)&&(a[t]=o)}}),a}}const be={[g.SC_CODE]:c.SOCIAL_NETWORK,[g.SP_CODE]:c.POST_REASON,[g.TR_CODE]:c.STEP,[g.CE_CODE]:c.NAME,[g.VP_CODE]:c.PURCHASE_ID,[g.PE_CODE]:c.NAME};class ke{constructor(){this.logger=_.getInstance(),this.transformer=N,this.helper=x,this.rules=new Ie}validateString(e,t){const s=t?.method||"validateString",r=t?.arg||"value",i=t?.exception,n=t?.required;return this.rules.validString(s,r,e,i,n)?{isValid:!0,value:e}:{isValid:!1,error:`${r} validation failed`}}validateNumber(e,t){const s=t?.method||"validateNumber",r=t?.arg||"value",i=t?.exception;return this.rules.validMinMaxDouble(s,r,e,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,i)?{isValid:!0,value:e}:{isValid:!1,error:`${r} validation failed`}}validateBoolean(e,t){const s=t?.method||"validateBoolean",r=t?.arg||"value",i=t?.exception;return this.rules.validBoolean(s,r,e,i)?{isValid:!0,value:e}:{isValid:!1,error:`${r} validation failed`}}notNullOrEmpty(e,t){const s=t?.method||"notNullOrEmpty",r=t?.arg||"value";return this.helper.isNullOrEmpty(e)?(this.logger.error("{arg} is empty!",{arg:r,method:s}),{success:!1,error:`${r} is empty`}):{success:!0,value:e}}validateRange(e,t,s,r){const i=r?.method||"validateRange",n=r?.arg||"value",a=this.validateNumber(e,r);return a.success?e<t?(this.logger.error("{arg} [{val}] is less than the min [{min}] permitted value!",{arg:n,method:i,val:e,min:t}),{success:!1,error:`${n} is less than minimum value ${t}`}):e>s?(this.logger.error("{arg} [{val}] is greater than the max [{max}] permitted value!",{arg:n,method:i,val:e,max:s}),{success:!1,error:`${n} is greater than maximum value ${s}`}):{success:!0,value:e}:a}validAppId(e,t){const s="The application key argument value",r=this.transformer.delNotValidChars(t),i=this.validateString(r,{method:e,arg:s});return this.trimString(e,s,i.value,255)}validUserId(e,t){const s="The user id argument value",r=this.transformer.delNotValidChars(t),i=this.validateString(r,{method:e,arg:s,exception:!1,required:!1});if(!i.isValid)return null;return this.trimString(e,s,i.value,64)}validReplaceId(e,t,s){const r="The user id argument value",i=this.validateString(t,{method:e,arg:r,exception:!0}),n=this.validateString(s,{method:e,arg:r,exception:!0});return{prevId:i.value,id:n.value}}validLevel(e,t){return this.validateRange(t,1,2147483646,{method:e,arg:"The level argument value"}).success??!1}validAppVer(e,t){const s="The app version argument value",r=this.transformer.delNotValidChars(t),i=this.validateString(r,{method:e,arg:s});if(!i.success)return null;return this.trimString(e,s,i.value,255)}validSdkVerCode(e,t){return this.rules.validMinMaxInteger(e,"The sdk version code argument value",t,1,2147483646)??!1}validTracking(e,t){return this.validateBoolean(t,{method:e,arg:"status"}).success??!1}validEvent(e,t,s="system",r={}){switch(e){case"sc":return this.rules.validSocialConnect(t,s);case"sp":return this.rules.validSocialPost(t,s);case"tr":return this.rules.validTutorial(t,s,r);case"rp":return this.rules.validRealCurrencyPayment(t,s,r);case"vp":return this.rules.validVirtualCurrencyPayment(t,s);case"ce":return this.rules.validCustomEvent(t,s,r);case"lu":return this.rules.validLevelUp(t,s);case"rf":return this.rules.validReferrer(t,s);case"adrv":return this.rules.validAdImpression(t,s);case"cb":return this.rules.validCurrencyBalance(t,s);default:return t}}validUserCardEntry(e,t,s){return{key:this.rules.validPlKey(e,t),value:this.rules.validPlVal(e,t,s)}}validUserCardKey(e,t,s=!0){return this.rules.validPlKey(e,t,s)}isExcluded(e,t,s){const r={code:t,arg:"unknown"};let i,n=!1;if(void 0!==e[t])if(0===e[t].length)n=!0,this.logger.info("Event [{code}] is excluded by project configuration",r);else{const a=be[t];this.helper.isNullOrEmpty(a)&&(i=a),i&&-1!==e[t].indexOf(s[i])&&(r.arg=i,this.logger.info("Event [{code}] with {arg} argument is excluded by project configuration",r),n=!0)}return n}validCA(e="CurrencyAccrual",t,s,r,i,n){const a=this.rules.validCA(e,t,s,r,i,n);return a[c.ACCRUAL_TYPE]=i,a[c.CURRENCY_NAME]=t,a[c.CURRENCY_AMOUNT]=s,a[c.CURRENCY_SOURCE]=r,a}validStartPe(e,t,s){return this.rules.validStartPe(e,t,s)}validStopPe(e,t,s){return this.rules.validStopPe(e,t,s)}trimString(e,t,s,r){return this.rules.trimString(e,t,s,r)}}var De;!function(e){e.IN="IN",e.NOT_IN="NOT IN",e.GREATER_THAN=">",e.LESS_THAN="<",e.EQUAL="==",e.NOT_EQUAL="!=",e.GREATER_EQUAL=">=",e.LESS_EQUAL="<="}(De||(De={}));class Ue{checkConditions(e,t){const s=JSON.stringify({condition:e,value:t});if(s in Ue.cachedChecks){const e=Ue.cachedChecks[s];if("boolean"==typeof e)return e}const r=this.checkConditionsInternal(e,t);return this.addToCache(s,r),r}checkConditionIn(e,t,s){if(!Array.isArray(t))return!1;if("string"!=typeof s&&!Number.isInteger(s))return!1;const r=t.indexOf(s)>-1;return e===De.NOT_IN?!r:r}checkEquality(e,t,s){const r=x.isEqual(t,s);return e===De.NOT_EQUAL?!r:r}checkComparison(e,t,s){if(typeof t==typeof s){const r=parseFloat(t),i=parseFloat(s);if(x.isInteger(i))switch(e){case De.GREATER_EQUAL:return i>=r;case De.GREATER_THAN:return i>r;case De.LESS_THAN:return i<r;case De.LESS_EQUAL:return i<=r;default:return!1}else if(x.isString(s)){const r=s.localeCompare(t);switch(e){case De.GREATER_EQUAL:case De.GREATER_THAN:return r>=0;case De.LESS_THAN:return r<0;case De.LESS_EQUAL:return r<=0;default:return!1}}}return!1}checkConditionsInternal(e,t){if(void 0===t)return!1;if(x.isObject(e)){let s=!0;return Object.entries(e).forEach(([e,r])=>{let i=!1;switch(e){case De.IN:case De.NOT_IN:i=this.checkConditionIn(e,r,t);break;case De.EQUAL:case De.NOT_EQUAL:i=this.checkEquality(e,r,t);break;case De.GREATER_THAN:case De.LESS_THAN:case De.GREATER_EQUAL:case De.LESS_EQUAL:i=this.checkComparison(e,r,t);break;default:i=!1}i||(s=!1)}),s}return x.isEqual(e,t)}addToCache(e,t){if(e in Ue.cachedChecks||Ue.cacheKeys.push(e),Ue.cachedChecks[e]=t,Ue.cacheKeys.length>Ue.MAX_CACHE_SIZE){const e=Ue.cacheKeys.shift();e&&delete Ue.cachedChecks[e]}}clearCache(){Ue.cachedChecks={},Ue.cacheKeys=[]}getCacheStats(){return{size:Ue.cacheKeys.length,maxSize:Ue.MAX_CACHE_SIZE,keys:[...Ue.cacheKeys]}}isValidCondition(e){if(x.isNullOrEmpty(e))return!1;if(x.isObject(e)){let t=!0;return Object.keys(e).forEach(e=>{Object.values(De).includes(e)||(t=!1)}),t}return!0}getSupportedOperators(){return Object.values(De)}isValidOperator(e){return Object.values(De).includes(e)}compare(e,t,s){switch(e){case De.IN:case De.NOT_IN:return this.checkConditionIn(e,s,t);case De.EQUAL:case De.NOT_EQUAL:return this.checkEquality(e,s,t);case De.GREATER_THAN:case De.LESS_THAN:case De.GREATER_EQUAL:case De.LESS_EQUAL:return this.checkComparison(e,s,t);default:return!1}}evaluateAnd(e,t){for(const[s,r]of Object.entries(e)){const e=t[s];if(!this.checkConditionsInternal(r,e))return!1}return!0}evaluateOr(e,t){for(const[s,r]of Object.entries(e)){const e=t[s];if(this.checkConditionsInternal(r,e))return!0}return!1}}Ue.MAX_CACHE_SIZE=200,Ue.cachedChecks={},Ue.cacheKeys=[];class we{constructor(e,t,s){const r=Date.now()+t;this.deadline=Math.floor(r/1e3),this._callback=e,this.id=s||this.deadline.toString()}run(){try{this._callback()}catch(e){}}getRemainingTime(){const e=Math.floor(Date.now()/1e3);return Math.max(0,this.deadline-e)}isOverdue(){return this.getRemainingTime()<=0}getInfo(){return{id:this.id,deadline:this.deadline,remainingTime:this.getRemainingTime(),isOverdue:this.isOverdue()}}}class Re{constructor(){this.timerId=null,this.queueTask={},this.queuePriority=[],this.status=0,this.timerId=null,this.queueTask={},this.queuePriority=[],this.status=0}static getInstance(){return Re.instance||(Re.instance=new Re),Re.instance}start(){0===this.status&&(this.status=1,this.timerId=setTimeout(()=>this.runTimer(),0),L.debug("Timer started"))}stop(){this.status=0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.clearAllTasks(),L.debug("Timer stopped")}pause(){this.status=0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),L.debug("Timer paused")}addTask(e){const t=e.deadline;-1===this.queuePriority.indexOf(t)&&(this.queuePriority.push(t),this.queuePriority.sort((e,t)=>e-t),this.queueTask[t]=[]),this.queueTask[t]?.push(e)}hasTask(e){for(const t of this.queuePriority){const s=this.queueTask[t];if(s)for(const t of s)if(t.id===e)return!0}return!1}removeTaskByKey(e){let t=!1;const s={},r=[];for(const i of this.queuePriority){const n=this.queueTask[i];if(n){const a=n.filter(t=>t.id!==e);a.length>0&&(s[i]=a,r.push(i)),a.length!==n.length&&(t=!0)}}return this.queuePriority=r,this.queueTask=s,t}getNextTask(){if(0===this.queuePriority.length)return null;const e=Math.floor(Date.now()/1e3),t=this.queuePriority[0];if(t&&t<=e){const e=this.queueTask[t];if(e&&e.length>0){const s=e.shift();return 0===e.length&&(this.queuePriority.shift(),delete this.queueTask[t]),s}}return null}runTimer(){this.timerId&&clearTimeout(this.timerId);try{let e=this.getNextTask();for(;e;)e.run(),e=this.getNextTask();1===this.status&&(this.timerId=setTimeout(()=>this.runTimer(),Re.TICK_INTERVAL))}catch(e){L.error("Timer execution error",{error:e}),1===this.status&&(this.timerId=setTimeout(()=>this.runTimer(),Re.TICK_INTERVAL))}}clearAllTasks(){this.queueTask={},this.queuePriority=[]}}Re.TICK_INTERVAL=1e3,Re.instance=null;const Oe=Re.getInstance();class Pe{constructor(e,t,s){this.status=0,this.delay=s,this.callback=t,this.key=e}abort(){0!==this.status&&this.taskId&&(Oe.removeTaskByKey(this.taskId),this.taskId=void 0)}run(){this.taskId=this.key,Oe.addTask(new we(this.onResponse.bind(this),Math.floor((Date.now()+this.delay)/1e3),this.key)),this.status=1}onResponse(){this.run();try{this.callback()}catch(e){L.error("Scheduler callback error",{key:this.key,error:e})}}start(){0===this.status&&(this.run(),L.debug("Scheduler [{key}] started with delay [{delay}]",{key:this.key,delay:this.delay}))}reset(){this.abort(),this.status=0,this.start()}stop(){this.abort(),0!==this.status&&L.debug("Scheduler [{key}] paused",{key:this.key}),this.status=0}setDelay(e){this.delay=e,this.reset()}}class xe{constructor(e,t){this.controller=null,this.defaultOptions={gzip:!0,method:"POST",timeout:6e3,withCredentials:!1,noContentType:!1},this.structure=e,this.callback=t}isCompressionSupported(){return ce()}async run(e){this.abort(),e={...this.defaultOptions,...e};const t=this.structure.url,s=e.method||this.structure.method||"POST",r=this.structure.body||{},i=this.structure.headers||{},n=this.structure.toBase64||[],a={Method:s,URL:t,Headers:{},EncodedHeaders:{},Content:{}};if(void 0!==this.structure.auxiliary){const e=this.structure.auxiliary;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}const o=(e,t,s)=>{void 0!==this.callback&&this.callback(e,t,s)},h=e=>{const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&!this.isNullOrEmpty(e[s])&&(t[s]=e[s]);return t};try{this.controller=new AbortController;const l=setTimeout(()=>{this.controller?.abort()},e.timeout||6e3),u={};let c=!1;for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e)&&!this.isNullOrEmpty(i[e])){const t=i[e];if(void 0!==t){let s=t;-1!==n.indexOf(e)&&(s=this.transformToBase64(t),c=!0),a.Headers[e]=t,a.EncodedHeaders[e]=s,u[e]=s}}if(c){const e="X-Id-Encoding";u[e]="base64",a.Headers[e]="base64",a.EncodedHeaders[e]="base64"}let g=null;if("GET"!==s&&"HEAD"!==s){const t=h(r);if(a.Content=t,e.gzip&&this.isCompressionSupported()){const e=JSON.stringify(t),{compressed:s,isCompressed:r}=await(async e=>{if(!ce())return{compressed:(new TextEncoder).encode(e),isCompressed:!1};try{const t=new CompressionStream("gzip"),s=t.writable.getWriter(),r=t.readable.getReader(),i=(new TextEncoder).encode(e),n=(async()=>{const e=[];let t=0;for(;;){const{done:s,value:i}=await r.read();if(s)break;e.push(i),t+=i.length}const s=new Uint8Array(t);let i=0;for(const t of e)s.set(t,i),i+=t.length;return s})();return await s.write(i),await s.close(),{compressed:await n,isCompressed:!0}}catch{return{compressed:(new TextEncoder).encode(e),isCompressed:!1}}})(e);r?(g=s,u["Content-Type"]="application/gzip",L.debug("[Task] Using compressed body")):(g=e,L.debug("[Task] Using uncompressed body"))}else g=JSON.stringify(t),L.debug("[Task] Compression disabled or not supported");e.noContentType||u["content-type"]||u["Content-Type"]||(u["Content-Type"]="application/json")}const d={method:s,headers:u,signal:this.controller.signal,credentials:e.withCredentials?"include":"same-origin"};"string"==typeof g?d.body=g:g instanceof Uint8Array&&(d.body=(e=>{if(e.buffer instanceof ArrayBuffer)return e;let t;e.buffer instanceof SharedArrayBuffer?(t=new ArrayBuffer(e.buffer.byteLength),new Uint8Array(t).set(new Uint8Array(e.buffer))):t=e.buffer;return new Uint8Array(t)})(g));const p=await fetch(t,d);let m;clearTimeout(l);const f=p.status;if(0===f)return void o(f,null,new Error("Internal Fetch Error"));try{const e=await p.text();try{m=JSON.parse(e)}catch{m=e}}catch{m=null}o(f,m)}catch(e){e instanceof Error?"AbortError"===e.name?o(0,null,new Error("Request timeout")):o(0,null,e):o(0,null,new Error("Unknown error occurred"))}L.debug(JSON.stringify(a,null,2))}async runWithBeacon(){if(!("sendBeacon"in navigator)||!navigator)return;this.abort();const e=this.structure.url,t=this.structure.body||{},s={Method:"POST",URL:e,EncodedFields:{},Content:{}},r=this.callback;s.Content=t;L.debug(JSON.stringify(s,null,2)),(e=>{void 0!==r&&r(e?200:0,{},null)})(navigator.sendBeacon(e,JSON.stringify(t)))}abort(){this.controller&&(this.controller.abort(),this.controller=null)}isNullOrEmpty(e){return null==e||""===e}transformToBase64(e){return this.isNullOrEmpty(e)?e:ue.encode(e)}}class Ne{constructor(){this.queueTask={},this.queueTask={}}stopTask(e){void 0!==this.queueTask[e]&&(this.queueTask[e].abort(),delete this.queueTask[e])}runTask(e,t,s,r,i){this.stopTask(e),this.queueTask[e]=new xe(t,(t,r,i)=>{s(t,r,i),this.stopTask(e)}),i?this.queueTask[e].runWithBeacon():this.queueTask[e].run(r)}static getInstance(){return Ne.instance||(Ne.instance=new Ne),Ne.instance}run(e,t,s,r,i){this.runTask(e,t,s,r,i)}stop(e){this.stopTask(e)}}Ne.instance=null;const _e=Ne.getInstance();var Le;!function(e){e[e.IDLE=0]="IDLE",e[e.SENDING=1]="SENDING",e[e.FOCUS_LOST=2]="FOCUS_LOST",e[e.COMPLETED=3]="COMPLETED"}(Le||(Le={}));const Ve=["language","sdkCodeVersion","sdkVersion","engine","appVersion"];class Be{constructor(e,t,s,r){this.status=Le.IDLE,this.tempEvents={},this.freezeTime=null,this.activeAbTest=null,this.key="events",this.api=_e,this.systemManager=e,this.userManager=t,this.storage=s,this.appManager=r,this.retryTime=15e3,this.unloadEventsMaxSize=6e4}getEventModel(){return this.storage.getEventModel()}getHash(e){const t=[];return Ve.forEach(s=>{void 0!==e[s]&&t.push(e[s])}),t.join("_")}createPackage(e){const t={events:[]};return Ve.forEach(s=>{const r=K[s];r&&void 0!==e[r]&&null!==e[r]&&(t[s]=e[r])}),this.appManager.getPlatformKey()&&(t.platformKey=this.appManager.getPlatformKey()||""),t}createRequestStructure(e=!1){const t={DeviceId:this.userManager.getDeviceId()||"",PreviousDeviceId:this.userManager.getPrevDeviceId()||"",UserId:this.userManager.getId()||"",PreviousUserId:this.userManager.getPrevUserId()||"",...this.appManager.getPlatformKey()&&{PlatformKey:this.appManager.getPlatformKey()||""}};if(this.userManager.haveBackendId()){const e=this.userManager.getD2dCrossId();e&&(t.CrossPlatformDevtodevId=e),t.DevtodevId=this.userManager.getD2dId()||"",t.DevtodevIdTimestamp=this.userManager.getD2dTm()?.toString()||""}const a={[s]:this.userManager.getDeviceId(),[r]:this.userManager.getPrevDeviceId(),[i]:this.userManager.getId(),[n]:this.userManager.getPrevUserId()};let o;return o=e?{userData:a,auxiliary:{},url:this.systemManager.buildDataUrl(["v2","analytics","report"],{appId:this.systemManager.getAppId()})}:{method:"POST",headers:t,body:{reports:[]},auxiliary:{},toBase64:["DeviceId","PreviousDeviceId","UserId","PreviousUserId"],url:this.systemManager.buildUrl(["v2","analytics","report"],{appId:this.systemManager.getAppId()})},o}addTaskRetry(e,t){Oe.hasTask(this.key)&&(Oe.removeTaskByKey(this.key),this.api.stop(this.key),L.info("Report has been abort"));const s=new we(t,e,this.key);Oe.addTask(s)}setFreezeTime(e){this.freezeTime=e}clearFreezeTime(){this.freezeTime=null}run(e=!1,t=!1){if(this.status===Le.IDLE||e&&this.status!==Le.COMPLETED){const e=this.run.bind(this,!0),s=this.getEventModel().getEventsByUser(this.userManager.getPrimaryId()),r={},i=[],n={};let a=!0,o=this.createRequestStructure(t);const h=[],l=this,u=x.generateUUID(),c=(t,s,r,i)=>{const n={id:i,status:t};r||200!==t?this.retryTime&&(this.addTaskRetry(this.retryTime,e),l.status=Le.IDLE,L.error("[EventQueue] Report [{id}] submission failed. Status code: {status}",n),L.debug("[EventQueue] The network queue is stopped")):(this.getEventModel().removeByPrimaryIds(h),setTimeout(()=>{l.run(!0)},0),L.info("[EventQueue] Report [{id}] has been sent successfully",n))},g=(e,t)=>{const s={id:t,status:e};200===e?(this.getEventModel().removeByPrimaryIds(h),setTimeout(()=>{l.run(!0)},0),L.info("Report [{id}] has been sent successfully",s)):L.error("Report [{id}] submission failed. Status code: {status}",s)};let d=0;const p=e=>{if(0===s.length)return!1;if(s.length<=e)return!1;if(t){if(d++,d%50==0){return!(x.getPackagesByteSize(r)>this.unloadEventsMaxSize)}return!0}return e<this.appManager.getCountForRequest()};this.status=Le.SENDING;for(const e in this.tempEvents)s.push(this.tempEvents[e]);this.tempEvents={};for(let e=0;p(e);e++){const t=s[e];if(!t)continue;const n=this.getHash(t);let o;const l=t[K.primaryId];o=void 0!==t[K.code]?t[K.code]:t[K.params]?.code;const u=t[K.params]?.timestamp;null!==this.freezeTime&&this.freezeTime<u||(r[n]||(r[n]=this.createPackage(t),i.push(n)),l&&h.push(l),a=!1,this.activeAbTest&&(t[K.params]=t[K.params]||{},t[K.params].inExperiments=[{id:this.activeAbTest.id,group:this.activeAbTest.group}]),t[K.params]=t[K.params]||{},t[K.params].code=o,r[n].events.push(t[K.params]))}if(this.getEventModel().removeByPrimaryIds(Object.keys(n)),!a){if(t){const e=Object.assign(o.userData,{packages:[]});i.forEach(t=>{r[t]&&e.packages.push(r[t])},i),o.auxiliary["Content UUID"]=u,o.body={reports:[e]}}else{const e={registrationDate:this.userManager.getRg()||null,packages:[]};i.forEach(t=>{r[t]&&e.packages.push(r[t])}),o.body={reports:[e]},o.auxiliary&&(o.auxiliary["Content UUID"]=u)}L.info("[EventQueue] Trying to send a report [{id}]",{id:u}),this.api.run(this.key,o,(e,s,r)=>{t?g(e,u):c(e,s,r,u)},{},t)}this.status=a?Le.IDLE:Le.SENDING}}start(){this.status=Le.IDLE}pause(){this.tempEvents={},this.status=Le.FOCUS_LOST}add(e,t){this.tempEvents[e]=t}send(e){this.status===Le.IDLE&&this.run(!1,e)}freeze(e){const t=null==e?Date.now():e;this.setFreezeTime(t)}unfreeze(){this.clearFreezeTime()}setActiveAbTest(e){this.activeAbTest=e}removeActiveAbTest(){this.activeAbTest=null}}const Fe="DeviceId",Ke="PreviousDeviceId",Ge="UserId",We="PreviousUserId",ze="PlatformKey";var qe,He,je,$e,Ye,Qe,Je,Xe,Ze,et;!function(e){e[e.IDLE=0]="IDLE",e[e.SENDING=1]="SENDING",e[e.RETRY=2]="RETRY",e[e.SUCCESS=3]="SUCCESS",e[e.INCOMPLETE=4]="INCOMPLETE",e[e.WAITING=5]="WAITING"}(qe||(qe={}));class tt{constructor(e,t,s,r,i,n,a={retryTime:6e4}){this.status=qe.IDLE,this.attempt=1,this.lastTimeResponse=0,this.api=_e,this.systemManager=t,this.userManager=s,this.appManager=r,this.key=e,this.callback=i,this.beforeRequest=n??void 0,this.retryTime=a.retryTime||6e4}createRequestStructure(){const e={headers:{[Fe]:this.userManager.getDeviceId()||"",[Ke]:this.userManager.getPrevDeviceId()||"",[Ge]:this.userManager.getUserId()||"",[We]:this.userManager.getPrevUserId()||"",...this.appManager.getPlatformKey()&&{[ze]:this.appManager.getPlatformKey()||""}},toBase64:[Fe,Ke,Ge,We,ze]},t=[];switch(this.key){case"sdk":e.body={sdkVersion:this.systemManager.getSdkVer(),appVersion:this.appManager.getAppVer()||"",excludeVersion:this.appManager.getExcludeVer()||"",sdkCodeVersion:this.systemManager.getSdkVerCode()},t.push("v2","analytics","config");break;case"remote":t.push("v2","remoteconfig","get");break;case"offer":t.push("v2","remoteconfig","offer");break;case"d2dId":t.push("v2","analytics","identification"),e.body={attempt:this.attempt}}return e.url=this.systemManager.buildUrl(t,{appId:this.systemManager.getAppId()}),e}addTaskRetryBack(e){Oe.addTask(new we(this.run.bind(this),e,this.key))}onResponse(e,t,s){if(this.lastTimeResponse=Date.now(),s||200!==e)if(422===e)this.status=qe.SUCCESS,this.attempt=0;else{let r=this.retryTime;if(202===e)this.status=qe.WAITING,this.retryTimeOutBack=t?.retryAfter,r=this.retryTimeOutBack||this.retryTime,this.attempt++;else if(s)L.debug(s?.message||"Unknown error");else{switch(this.attempt=0,this.status=qe.RETRY,this.key){case"sdk":case"remote":L.debug(`Failed to get analytics configuration, using the default configuration and retrying after ${Math.floor(r/1e3)} seconds`);break;case"d2dId":L.error(`BackendIdentifiers unknown status code ${e}. Retrying after ${Math.floor(r/1e3)} seconds`)}this.addTaskRetryBack(r)}}else this.status=qe.SUCCESS,this.callback&&this.callback(t),this.attempt=0}run(){const e=this.createRequestStructure();this.status=qe.SENDING,this.beforeRequest&&this.beforeRequest(e),this.api.run(this.key,e,(e,t,s)=>{this.onResponse(e,t,s)})}abort(){this.api.stop(this.key)}pause(){[qe.SENDING,qe.RETRY].includes(this.status)&&(this.abort(),this.status=qe.INCOMPLETE)}start(){if([qe.IDLE,qe.INCOMPLETE].includes(this.status))this.run();else if(this.status===qe.WAITING){const e=this.lastTimeResponse+(this.retryTimeOutBack||0)-Date.now();e>0?this.addTaskRetryBack(e):this.run()}}clear(){this.abort(),this.status=qe.IDLE}}class st{isAvailable(){try{if(!("localStorage"in window)||null===window.localStorage)return!1;const e="__dtd_test__",t="test";window.localStorage.setItem(e,t);const s=window.localStorage.getItem(e);return window.localStorage.removeItem(e),s===t}catch(e){return L.warning("LocalStorage not available",{error:e}),!1}}setItem(e,t){try{window.localStorage.setItem(e,t)}catch(t){L.error("Failed to set localStorage item",{key:e,error:t})}}getItem(e){try{const t=window.localStorage.getItem(e);return void 0===t?null:t}catch(t){return L.error("Failed to get localStorage item",{key:e,error:t}),null}}removeItem(e){try{window.localStorage.removeItem(e)}catch(t){L.error("Failed to remove localStorage item",{key:e,error:t})}}getLimit(){return 5242880}}class rt{constructor(){this.defaultExpiry=31536e6}isAvailable(){try{if(void 0!==window.navigator&&void 0!==window.navigator.cookieEnabled)return window.navigator.cookieEnabled;const e="testcookie",t="test";this.setItem(e,t);const s=this.getItem(e);return this.removeItem(e),s===t}catch(e){return L.warning("Cookies not available",{error:e}),!1}}setItem(e,t,s){try{const{expires:r=this.defaultExpiry,path:i="/",domain:n,secure:a=!1,sameSite:o="Lax"}=s||{},h=new Date;h.setTime(Date.now()+r);let l=`${e}=${encodeURIComponent(t)}; expires=${h.toUTCString()}; path=${i}`;n&&(l+=`; domain=${n}`),a&&(l+="; secure"),o&&(l+=`; samesite=${o}`),document.cookie=l}catch(t){L.error("Failed to set cookie",{key:e,error:t})}}getItem(e){try{const t=document.cookie.split(";");for(const s of t){const[t,r]=s.split("=");if(x.trimmer(t)===e)return decodeURIComponent(r||"")}return null}catch(t){return L.error("Failed to get cookie",{key:e,error:t}),null}}removeItem(e){try{const t=new Date("Thu, 01 Jan 1970 00:00:00 GMT");document.cookie=`${e}=; expires=${t.toUTCString()}; path=/`}catch(t){L.error("Failed to remove cookie",{key:e,error:t})}}getLimit(){return 4096}}class it{constructor(){this.storage={},this.maxSize=10485760,this.currentSize=0}isAvailable(){return!0}setItem(e,t){try{const s=new Blob([t]).size,r=this.storage[e],i=r?new Blob([r]).size:0;if(this.currentSize-i+s>this.maxSize)throw L.warning("Memory storage limit exceeded",{key:e,valueSize:s,currentSize:this.currentSize,maxSize:this.maxSize}),"Memory storage limit exceeded";this.storage[e]=t,this.currentSize=this.currentSize-i+s}catch(t){L.error("Failed to set memory storage item",{key:e,error:t})}}getItem(e){try{const t=this.storage[e];return void 0===t?null:t}catch(t){return L.error("Failed to get memory storage item",{key:e,error:t}),null}}removeItem(e){try{const t=this.storage[e];if(t){const s=new Blob([t]).size;delete this.storage[e],this.currentSize-=s}}catch(t){L.error("Failed to remove memory storage item",{key:e,error:t})}}getLimit(){return this.maxSize}}class nt{constructor(e,t,s,r={}){this.storage=t,this.appId=e,this.key=s,this.useBase64=r.base64??!1,this.storageKey=this.generateKey()}set(e){const t=this.encode(e);this.storage.setItem(this.storageKey,t)}get(e){const t=this.storage.getItem(this.storageKey);return null==t?e:this.decode(t)??e}purgeModel(){this.storage.removeItem(this.storageKey)}encode(e){const t=JSON.stringify(e);return this.useBase64?ue.encode(t):t}decode(e){try{const t=this.useBase64?ue.decode(e):e;return JSON.parse(t)}catch{return null}}generateKey(){const e=`${this.appId}_${this.key}`;return this.useBase64?ue.encode(e):e}}class at extends nt{constructor(e,t,s={}){super(e,t,A,s),this.primaryId="",this.users={},this.userData={},this.userExperiments=null,this.userRemoteConfig=null,this.sync()}getAttr(e,t){if(!e&&!t)return null;const s="string"==typeof e?[e]:e,r=s.length;if(!r)return t;let i=this.userData;for(let e=0;e<r&&null!=i;++e){const r=s[e];if(!r||void 0===i[r]){i=t;break}i=i[r]}return i}setAttrs(e){for(const t in e)void 0!==e[t]&&(this.userData[t]=e[t]);this.userData[G.lastActive]=Date.now(),this.setUserData(this.userData)}removeAttribute(e){delete this.userData[e],super.set(this.userData),this.sync()}clearBackendIdHelper(e){const t={...e};return delete t[G.devtodevId],delete t[G.crossPlatformDevtodevId],delete t[G.devtodevIdTimestamp],t}setUserData(e){this.users[this.primaryId]=e,super.set(this.users),this.sync()}matchesCondition(e,t){for(const s in t)if(e[s]!==t[s])return!1;return!0}initDependentStorages(){this.userExperiments=new ot(this.userData[G.userExperiments]||{},this.setAttr.bind(this)),this.userRemoteConfig=new ht(this.userData[G.remoteConfigData]||{},this.setAttr.bind(this)),this.sync()}sync(){this.users=this.get({})}init(e){this.primaryId=e,this.userData=this.clearBackendIdHelper(this.users[e]||{}),this.initDependentStorages()}create(e,t){this.primaryId=x.generateUUID(),this.userData={[G.created]:Date.now(),[G.userId]:e,[G.isDefault]:t,[G.deviceId]:e},this.setUserData(this.userData),this.initDependentStorages()}setAttr(e,t){this.setAttrs({[e]:t})}replaceUserId(e,t=!1){const s=this.getAttr(G.userId);let r={};s!==e&&null!==e&&(r={[G.prevUserId]:s,[G.prevDeviceId]:s,[G.userId]:e,[G.isDefault]:t,[G.deviceId]:e},r=this.clearBackendIdHelper(r),this.setAttrs(r))}getPrimaryId(){return this.primaryId}getUserId(){return this.getAttr(G.userId)}getDeviceId(){return this.getAttr(G.deviceId)}getPrevDeviceId(){return this.getAttr(G.prevDeviceId)}getPrevUserId(){return this.getAttr(G.prevUserId)}getRg(){return this.getAttr(G.created)}setDefault(e){this.setAttr(G.isDefault,e)}isDefault(){return!!this.getAttr(G.isDefault,!1)}getLevel(){return this.getAttr(G.currentLevel,1)}setLevel(e){this.setAttr(G.currentLevel,e)}getAttrByKey(e){return this.getAttr(e)}setAttrByKey(e,t){this.setAttr(e,t)}getSessionId(){return this.getAttr(G.sessionStarted)}newSession(e){this.setAttr(G.sessionStarted,e),this.setAttr(G.sessionLength,0),this.setAttr(G.lastForeground,e)}resumeSession(){this.setAttr(G.lastForeground,Date.now())}getSessionLength(){return this.getAttr(G.sessionLength,0)}incrementSession(){const e=Date.now(),t=this.getSessionLength(),s=Math.floor((e-this.getLastForeground())/1e3);this.setAttr(G.sessionLength,t+s),this.setAttr(G.lastForeground,e)}clearSessionLength(){this.setAttr(G.sessionLength,0)}getLastForeground(){return this.getAttr(G.lastForeground,Date.now())}isUserCounting(){return!!this.getAttr(G.userCounting,!1)}setUserCounting(e){this.setAttr(G.userCounting,e)}getD2dId(){return this.getAttr(G.devtodevId)}getD2dCrossId(){return this.getAttr(G.crossPlatformDevtodevId)}getD2dTm(){return this.getAttr(G.devtodevIdTimestamp)}clearBackendId(){this.userData=this.clearBackendIdHelper(this.userData),this.setUserData(this.userData)}haveBackendId(){return!!(this.getAttr(G.devtodevId)||this.getAttr(G.crossPlatformDevtodevId)||this.getAttr(G.devtodevIdTimestamp))}setIsUserPay(){this.setAttr(G.isPayingUser,!0)}isPayingUser(){return!!this.getAttr(G.isPayingUser,!1)}canBalanceSentTime(){return!!this.getAttr(G.timeSentBalance,!1)}refreshBalanceSentTime(){this.setAttr(G.timeSentBalance,!0)}turnOffRef(){this.setAttr(G.referralStatus,!1)}isTurnOnRef(){return!!this.getAttr(G.referralStatus,!0)}isTracking(){return!!this.getAttr(G.tracking,!0)}setTracking(e){this.setAttr(G.tracking,e)}getTutorialSteps(){return this.getAttr(G.tutorialSteps,[])}insertTutorStep(e){const t=this.getTutorialSteps();t.push(e),this.setAttr(G.tutorialSteps,t)}setCA(e){this.setAttr(G.currencyAccrual,e)}getCA(){return this.getAttr(G.currencyAccrual,{})}clearCA(){this.removeAttribute(G.currencyAccrual)}getCard(){return this.getAttr(G.profile,{})}getCardField(e){return this.getCard()[e]}setCardField(e,t){const s=this.getCard(),r=this.getCardChanges();s[e]=t,r[e]=t,this.setAttrs({[G.profile]:s,[G.updateProfile]:r})}unsetCardField(e){const t=this.getCard(),s=this.getCardChanges();delete t[e],s[e]=null,this.setAttrs({[G.profile]:t,[G.updateProfile]:s})}clearCard(){this.setAttr(G.profile,{})}clearCardChanges(){this.setAttr(G.updateProfile,{})}getCardChanges(){return this.getAttr(G.updateProfile,{})}getUserProperties(){return this.getCard()}removeUserByPrimaryId(e){delete this.users[e],super.set(this.users),this.sync()}findPrimaryIdByCondition(e){for(const t of Object.keys(this.users)){const s=this.users[t];if(s&&this.matchesCondition(s,e))return t}return null}replaceUserIdForPrimaryUserId(e,t,s){let r=this.users[e];r&&(r[G.prevUserId]=r[G.userId],r[G.userId]=t,r[G.isDefault]=s,r[G.lastActive]=Date.now(),r[G.deviceId]=t,r=this.clearBackendIdHelper(r),this.users[e]=r,super.set(this.users),this.sync())}findUserByPrimaryId(e){return this.users[e]||null}lastActive(){return this.findPrimaryIdByCondition({[G.lastActive]:Math.max(...Object.values(this.users).map(e=>e[G.lastActive]))})}getIsMigrated(){return this.userData[G.isMigrated]||!1}setIsMigrated(e){this.setAttr(G.isMigrated,e)}getActiveExperiment(){const e=this.getAttr(G.activeExperiment,{});return e?.[H.activeExperiment]}clearActiveExperiment(){const e=this.getAttr(G.activeExperiment,{});e[H.activeExperiment]=null,this.setAttr(G.activeExperiment,e)}getExperiments(){return this.userExperiments}getRemoteConfig(){return this.userRemoteConfig}getRefusedExperiments(){const e=this.getAttr(G.activeExperiment,{});return e?.[H.refusedExperiments]||[]}getUsersList(){const e=[];return Object.values(this.users).forEach(t=>{e.push({userId:t[G.userId],isDefault:t[G.isDefault]})}),e}}class ot{constructor(e,t){this.experimentsStorage=e,this.setAttr=t,this.experimentsStorage[W.experimentsVersion]||(this.experimentsStorage={...this.experimentsStorage||{},[W.experimentsVersion]:0}),this.experimentsStorage[W.experiments]||(this.experimentsStorage={...this.experimentsStorage||{},[W.experiments]:{}}),this.setAttr(G.userExperiments,this.experimentsStorage)}sync(){this.setAttr(G.userExperiments,this.experimentsStorage)}formatFromStorageKeys(e){return{id:e[q.id],conditions:e[q.conditions]||[],isTesting:e[q.isTesting]??!1,parameters:e[q.parameters]??[],creationDate:e[q.creationDate]??0,updateDate:e[q.updateDate]??0,completionDate:e[q.completionDate]??0,isRefused:e[q.isRefused]??!1}}formatToStorageKeys(e){return{[q.id]:e.id,[q.conditions]:e.conditions||[],[q.isTesting]:e.isTesting??!1,[q.parameters]:e.parameters||{},[q.creationDate]:e.creationDate??0,[q.updateDate]:e.updateDate??0,[q.completionDate]:e.completionDate??0,[q.isRefused]:e.isRefused??!1}}update(e){e.id&&(this.experimentsStorage[W.experiments]?.[e.id]||(this.experimentsStorage[W.experiments]={...this.experimentsStorage[W.experiments],[e.id]:{}}),this.experimentsStorage[W.experiments][e.id]=this.formatToStorageKeys(e),this.sync())}insert(e){e.id&&(this.experimentsStorage[W.experiments]?.[e.id]||(this.experimentsStorage[W.experiments]={...this.experimentsStorage[W.experiments],[e.id]:{}}),this.experimentsStorage[W.experiments][e.id]=this.formatToStorageKeys(e),this.sync())}remove(e){e&&(delete this.experimentsStorage[W.experiments][e],this.sync())}get(e){return e&&this.experimentsStorage[W.experiments][e]?this.formatFromStorageKeys(this.experimentsStorage[W.experiments][e]):null}getExperimentsVersion(){return this.experimentsStorage[W.experimentsVersion]}setExperimentsVersion(e){this.experimentsStorage[W.experimentsVersion]=e,this.sync()}getAll(){return this.experimentsStorage[W.experiments]?Object.values(this.experimentsStorage[W.experiments]).map(e=>this.formatFromStorageKeys(e)):[]}}class ht{constructor(e,t){this.remoteConfigData=e,this.setAttr=t}sync(){this.setAttr(G.remoteConfigData,this.remoteConfigData)}getRemoteVersion(){return this.remoteConfigData[z.remoteVersion]||0}setRemoteVersion(e){this.remoteConfigData[z.remoteVersion]=e,this.sync()}getActiveRemoteConfig(){return this.remoteConfigData[z.activeRemoteConfig]||null}setActiveRemoteConfig(e){this.remoteConfigData[z.activeRemoteConfig]=e,this.remoteConfigData[z.invalidated]=!1,this.sync()}getConfigDefault(){return this.remoteConfigData[z.remoteConfigDefault]||{}}setConfigDefault(e){this.remoteConfigData[z.remoteConfigDefault]||(this.remoteConfigData[z.remoteConfigDefault]={}),this.remoteConfigData[z.remoteConfigDefault]=e,this.remoteConfigData[z.invalidated]=!1,this.sync()}getConfig(){return this.remoteConfigData[z.remoteConfig]||{}}setConfig(e){this.remoteConfigData[z.remoteConfig]||(this.remoteConfigData[z.remoteConfig]={}),this.remoteConfigData[z.remoteConfig]=e,this.remoteConfigData[z.invalidated]=!1,this.sync()}updateConfig(e){Object.entries(e).forEach(([e,t])=>{this.remoteConfigData[z.remoteConfig][e]=t}),this.remoteConfigData[z.invalidated]=!1,this.sync()}clearAllConfigs(){this.remoteConfigData[z.remoteConfig]={},this.remoteConfigData[z.remoteConfigDefault]={},this.remoteConfigData[z.activeRemoteConfig]=null,this.remoteConfigData[z.remoteVersion]=0,this.remoteConfigData[z.invalidated]=!1,this.sync()}isInvalidated(){return this.remoteConfigData?.[z.invalidated]??!1}invalidate(){0!=this.remoteConfigData[z.remoteVersion]&&(this.remoteConfigData[z.invalidated]=!0),this.sync()}}class lt extends nt{constructor(e,t,s={}){super(e,t,S,s),this.appData={}}getAttribute(e,t){const s=Array.isArray(e)?e:[e],r=s.length;if(!r)return t;let i=this.appData;for(let e=0;e<r&&null!=i;++e){const r=s[e];if(!r||!i[r]){i=t;break}i=i[r]}return i}setAttr(e,t){this.setAttrs({[e]:t})}setAttrs(e){Object.assign(this.appData,e),this.set(this.appData)}init(){this.sync(),null===this.getAttribute(j.uuid,null)&&(this.appData[j.uuid]=x.generateUUID(),this.setAttrs(this.appData))}sync(){this.appData=this.get({})}isMigration(){return this.getAttribute([j.isMigration],0)}addTransactionId(e){if(e&&e.trim()){const t=this.getTransactionIds();t.push(e),this.setAttr(j.transactionIds,t)}}setAppVer(e){this.setAttr(j.appVersion,e)}setConfigSdk(e){this.setAttr(j.config,e)}isAllExcluded(){return!!this.getAttribute(`${j.config}.exclude.all`,!1)}getEventsExcluded(){return this.getAttribute(`${j.config}.exclude.events`,{})}getAppVer(){return this.getAttribute([j.appVersion])}getMaxEventParams(){return this.getAttribute([j.config,"eventParamsCount"],20)}getTransactionIds(){return this.getAttribute([j.transactionIds],[])}getSessionTimeout(){return this.getAttribute([j.config,"sessionTimeout"],6e5)}getCountForRequest(){return this.getAttribute([j.config,"countForRequest"],10)}getAbTimeout(){return this.getAttribute([j.config,"abTestStartTimeout"],3e4)}getExcludeVer(){return this.getAttribute([j.config,"exclude","version"])}getTimeForRequest(){return this.getAttribute([j.config,"timeForRequest"],12e4)}getAliveTimeout(){return this.getAttribute([j.config,"aliveTimeout"],3e5)}getCATimeout(){return this.getAttribute([j.config,"currencyAggregationTimeout"],36e4)}getUUID(){return this.getAttribute([j.uuid])}setAttributes(e){this.setAttrs(e)}}class ut extends nt{constructor(e,t,s={}){super(e,t,M,s)}getEvents(){return this.get([])}addEvent(e){const t=this.getEvents();let s=1;if(0!==t?.length){const e=t[t.length-1];e&&e[K.primaryId]&&(s=e[K.primaryId]+1)}e[K.primaryId]=s,t.push(e),this.set(t)}removeByPrimaryIds(e){const t=this.getEvents(),s=new Set(e.map(e=>e.toString())),r=t.filter(e=>e&&!s.has((e[K.primaryId]??"")?.toString()));this.set(r)}removeByPrimaryUserId(e){const t=this.getEvents(),s=[];for(let r=t.length-1;r>=0;r--){const i=t[r];i&&i[K.primaryUserId]!==e&&s.unshift(i)}this.set(s)}getCountEventsByUser(e){return this.getEvents().map(t=>t&&t[K.primaryUserId]===e?t:null).filter(Boolean).length}getEventsByUser(e){return this.getEvents().map(t=>t&&t[K.primaryUserId]===e?t:null).filter(Boolean)}}class ct extends nt{constructor(e,t,s={}){super(e,t,T,s)}formatToStorageKeys(e){return{[q.id]:e.id,[q.conditions]:e.conditions,[q.isTesting]:e.isTesting,[q.parameters]:e.parameters,[q.creationDate]:e.creationDate,[q.updateDate]:e.updateDate,[q.completionDate]:e.completionDate,[q.isRefused]:e.isRefused||!1}}formatFromStorageKeys(e){return{id:e[q.id]??null,conditions:e[q.conditions]??[],isTesting:e[q.isTesting]??!1,parameters:e[q.parameters]??{},creationDate:e[q.creationDate]??0,updateDate:e[q.updateDate]??0,completionDate:e[q.completionDate]??0,isRefused:e[q.isRefused]??!1}}getExperimentsFromStorage(){return this.get({})}getExperiments(){const e=this.getExperimentsFromStorage(),t={};return Object.entries(e||{}).map(([e,s])=>{t[e]=this.formatFromStorageKeys(s)}),t}getExperiment(e){return this.getExperiments()[e]||null}setExperiment(e,t){const s=this.getExperimentsFromStorage(),r=this.formatToStorageKeys(t);s[e]=r,this.set(s)}removeExperiment(e){const t=this.getExperimentsFromStorage();delete t[e],this.set(t)}clearExperiments(){this.set({})}purgeItself(){this.purgeModel()}}class gt extends nt{constructor(e,t,s={}){super(e,t,I,s),this.pluginsData={},this.sync()}sync(){this.pluginsData=this.get({})}getPluginData(e){return{...this.pluginsData[e]||{}}}getPluginField(e,t){return this.getPluginData(e)[t]}setPluginField(e,t,s){this.pluginsData[e]||(this.pluginsData[e]={}),this.pluginsData[e][t]=s,this.persist()}setPluginFields(e,t){this.pluginsData[e]||(this.pluginsData[e]={}),Object.assign(this.pluginsData[e],t),this.persist()}removePluginField(e,t){this.pluginsData[e]&&(delete this.pluginsData[e][t],this.persist())}clearPluginData(e){this.pluginsData[e]&&(delete this.pluginsData[e],this.persist())}getAllPluginsData(){return{...this.pluginsData}}persist(){this.set(this.pluginsData)}}class dt{constructor(){this.storageType="memory",this.models={},this.storage=this.initializeStorage()}initializeStorage(){const e=new st;if(e.isAvailable())return this.storageType="localStorage",e;L.info("Access to local storage not available");const t=new rt;return t.isAvailable()?(this.storageType="cookies",t):(L.info("Access to cookies not available"),this.storageType="memory",new it)}init(e,t={}){this.models.app=new lt(e,this.storage,t),this.models.user=new at(e,this.storage,t),this.models.event=new ut(e,this.storage,t),this.models.experiments=new ct(e,this.storage,t),this.models.plugin=new gt(e,this.storage,t)}getAppModel(){return this.models.app}getUserModel(){return this.models.user}getEventModel(){return this.models.event}getExperimentsModel(){return this.models.experiments}getPluginModel(){return this.models.plugin}isAvailable(){return this.storage.isAvailable()}getStorageType(){return this.storageType}getStorageDriver(){return this.storage}getUsersList(){return this.models.user.getUsersList()}}class pt{constructor(e){this.config=e,this.attributes=this.initializeAttributes()}initializeAttributes(){try{const e="undefined"!=typeof navigator?navigator.userAgent:"",t=ge.detectOS(),s=pe.detectDevice(this.config.engine),r=me.detectBrowser();return{appId:null,base64:this.config.base64??!0,osName:t.name,osVer:t.version,sdkVer:this.config.sdkVersion,sdkVerCode:this.config.sdkVersionCode,agent:e,tzOffset:-60*(new Date).getTimezoneOffset(),lang:fe.getLanguageISO639_1(),resolution:ve.calculateDisplayResolution(),apiUrl:this.config.apiUrl,dataApiUrl:this.config.dataApiUrl,callbackDId:null,isBot:s.isBot,engine:this.config.engine||r.engine,testCustomUrl:null,countingTypeCallback:()=>{}}}catch(e){return L.error("[System] Failed to initialize attributes",{error:e}),this.getDefaultAttributes()}}getDefaultAttributes(){return{appId:null,base64:!0,osName:"unknown",osVer:"unknown",sdkVer:this.config.sdkVersion,sdkVerCode:this.config.sdkVersionCode,agent:"",tzOffset:0,lang:"en",resolution:"0x0",apiUrl:"https://statgw.devtodev.com",dataApiUrl:"https://api.devtodev.com",callbackDId:null,isBot:!1,engine:"unknown",testCustomUrl:null,countingTypeCallback:()=>{}}}setSdkVerCode(e){"Native"!==this.attributes.engine&&(this.attributes.sdkVerCode=e)}setSdkVer(e){"Native"!==this.attributes.engine&&(this.attributes.sdkVer=e)}isBase64(){return this.attributes.base64}setAppId(e){this.attributes.appId=e}getAppId(){return this.attributes.appId||""}getSdkVer(){return this.attributes.sdkVer}getSdkVerCode(){return this.attributes.sdkVerCode}getUA(){return this.attributes.agent}getTzOffset(){return this.attributes.tzOffset}getLanguage(){return this.attributes.lang}getOsName(){return this.attributes.osName}getOsVer(){return this.attributes.osVer}getDisplayResolution(){return this.attributes.resolution}buildUrl(e,t,s){const r=[s||this.attributes.apiUrl];r.push(...e);const i=new URL(r.join("/"));return Object.entries(t).forEach(([e,t])=>{i.searchParams.append(e,String(t))}),i.toString()}buildDataUrl(e,t){const s=[this.attributes.dataApiUrl];s.push(...e);const r=new URL(s.join("/"));return Object.entries(t).forEach(([e,t])=>{r.searchParams.append(e,String(t))}),r.toString()}setCallbackDId(e){"function"!=typeof e&&null!==e||(this.attributes.callbackDId=e)}getCallbackDId(){return this.attributes.callbackDId}isBot(){return this.attributes.isBot}useXDR(){return"undefined"!=typeof window&&!!window.XDomainRequest}getEngine(){return this.attributes.engine}setEnv(e){if(void 0!==e){["engine","base64"].forEach(t=>{void 0!==e[t]&&(this.attributes[t]=e[t])})}}getApiUrl(){return this.attributes.apiUrl}setApiUrl(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1)),this.attributes.apiUrl=e}getTestCustomUrl(){return this.attributes.testCustomUrl}setTestCustomUrl(e){this.attributes.testCustomUrl=e}setCountingTypeCallback(e){this.attributes.countingTypeCallback=e}getCountingTypeCallback(){return this.attributes.countingTypeCallback}}!function(e){e.BLUR="blur",e.FOCUS="focus",e.BEFORE_UNLOAD="beforeunload",e.FULLSCREEN_CHANGE="fullscreenchange",e.MOZ_FULLSCREEN_CHANGE="mozfullscreenchange",e.WEBKIT_FULLSCREEN_CHANGE="webkitfullscreenchange",e.MS_FULLSCREEN_CHANGE="msfullscreenchange"}(He||(He={}));class mt{constructor(e,t,s,r){this.onBlur=()=>{L.debug("Event onBlur");try{this.blurCallback()}catch(e){L.error("Blur callback error",{error:e})}},this.onFocus=()=>{L.debug("Event onFocus");try{this.focusCallback()}catch(e){L.error("Focus callback error",{error:e})}},this.onFullScreenChange=e=>{e?(this.removeEvent(window,He.BLUR,this.onBlur),this.removeEvent(window,He.FOCUS,this.onFocus),L.debug("Event full screen")):(this.addEvent(window,He.BLUR,this.onBlur),this.addEvent(window,He.FOCUS,this.onFocus),L.debug("Event normal screen"));try{this.fullScreenChangeCallback(e)}catch(t){L.error("Fullscreen change callback error",{error:t,isFull:e})}},this.onBeforeUnload=()=>{L.debug("Event onBeforeUnload");try{this.beforeUnloadCallback()}catch(e){L.error("Before unload callback error",{error:e})}},this.blurCallback=e,this.focusCallback=t,this.fullScreenChangeCallback=s,this.beforeUnloadCallback=r}start(){this.addFullScreenChangeListeners(),this.addWindowListeners()}addFullScreenChangeListeners(){const e=()=>{this.onFullScreenChange(this.isFullScreen())};this.addEvent(document,He.FULLSCREEN_CHANGE,e),this.addEvent(document,He.MOZ_FULLSCREEN_CHANGE,e),this.addEvent(document,He.WEBKIT_FULLSCREEN_CHANGE,e),this.addEvent(document,He.MS_FULLSCREEN_CHANGE,e)}addWindowListeners(){this.addEvent(window,He.BLUR,this.onBlur),this.addEvent(window,He.FOCUS,this.onFocus),this.addEvent(window,He.BEFORE_UNLOAD,this.onBeforeUnload)}addEvent(e,t,s){e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s)}removeEvent(e,t,s){e.removeEventListener?e.removeEventListener(t,s,!1):e.detachEvent("on"+t,s)}isFullScreen(){return!!(document.fullscreenElement||document.mozFullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}}class ft{constructor(e,t,s,r){this.eventListeners=null,this.isStarted=!1,this.eventListeners=new mt(e,t,s,r)}start(){this.isStarted?L.warning("Event listener manager already started"):(this.eventListeners&&this.eventListeners.start(),this.isStarted=!0,L.debug("Event listener manager started"))}}class vt{constructor(e,t){this.validator=new ke,this.storage=e,this.appManager=t}getUserModel(){return this.storage.getUserModel()}init(e){const t=this.appManager.getUUID();null!==e&&(e=this.validator.validUserId("Initialize",e));const s=!e,r=this.getUserModel().lastActive(),i=s||e===t;if(i&&(e=t),r)if(i)this.getUserModel().init(r);else{const t=this.getUserModel().findPrimaryIdByCondition({[G.userId]:e});t?this.getUserModel().init(t):(this.getUserModel().init(r),this.getUserModel().isDefault()||this.getUserModel().isUserCounting()?this.getUserModel().replaceUserId(e):this.getUserModel().create(e,i))}else this.getUserModel().create(e,i),L.debug("It is clean SDK start")}setUserD2dIdData(e){Object.keys(G).forEach(t=>{void 0!==e[t]&&this.setAttr(G[t],e[t])});const t=this.getD2dId(),s=this.getD2dTm();let r="For user [{userId}] updated backendIdentifiers are: \r\ndevtodevId {devtodevId} \r\ndevtodevIdTimestamp: {d2dTm}";const i={userId:this.getDeviceId(),devtodevId:t,d2dTm:s};this.getD2dCrossId()&&(r+="\r\ncrossPlatformDevtodevId: {cDevtodevId}",i.cDevtodevId=this.getD2dCrossId()),L.debug(r,i)}setCA(e){const t=e[c.CURRENCY_SOURCE],s=e[c.ACCRUAL_TYPE],r=e[c.CURRENCY_AMOUNT],i=e[c.CURRENCY_NAME],n=this.getCA();x.isNullOrEmpty(n[h[s]])&&(n[h[s]]={}),x.isNullOrEmpty(n[h[s]][t])&&(n[h[s]][t]={}),x.isNullOrEmpty(n[h[s]][t][i])&&(n[h[s]][t][i]=0),n[h[s]][t][i]+=r,this.getUserModel().setCA(n)}getCA(){return this.getUserModel().getCA()}clearCA(){this.getUserModel().clearCA()}getSessionId(){return this.getUserModel().getSessionId()||0}resumeSession(){this.getUserModel().resumeSession()}newSession(e){this.getUserModel().newSession(e)}incrementSession(){this.getUserModel().incrementSession()}getSessionLength(){return this.getUserModel().getSessionLength()}clearSessionLength(){this.getUserModel().clearSessionLength()}getLastForeground(){return this.getUserModel().getLastForeground()}getId(){return this.getUserModel().getUserId()||""}getDeviceId(){return this.getUserModel().getDeviceId()||""}getPrimaryId(){return this.getUserModel().getPrimaryId()||""}getPrevDeviceId(){return this.getUserModel().getPrevDeviceId()||""}getPrevUserId(){return this.getUserModel().getPrevUserId()||""}getUserId(){return this.getUserModel().getUserId()||""}isTracking(){return this.getUserModel().isTracking()}setTracking(e){this.getUserModel().setTracking(e)}isDefault(){return this.getUserModel().isDefault()}setDefault(e){this.getUserModel().setDefault(e)}isUserCounting(){return this.getUserModel().isUserCounting()}setUserCounting(e){this.getUserModel().setUserCounting(e)}getLevel(){return this.getUserModel().getLevel()}setLevel(e){this.getUserModel().setLevel(e)}getCard(){return this.getUserModel().getCard()}getCardField(e){return this.getUserModel().getCardField(e)}setCardField(e,t){this.getUserModel().setCardField(e,t)}unsetCardField(e){this.getUserModel().unsetCardField(e)}getCardChanges(){return this.getUserModel().getCardChanges()}clearCardChanges(){this.getUserModel().clearCardChanges()}getD2dId(){return this.getUserModel().getD2dId()}getD2dCrossId(){return this.getUserModel().getD2dCrossId()}getD2dTm(){const e=this.getUserModel().getD2dTm();return null!==e?String(e):null}haveBackendId(){return this.getUserModel().haveBackendId()}clearBackendId(){this.getUserModel().clearBackendId()}create(e,t){this.getUserModel().create(e,t)}replaceUserId(e,t){this.getUserModel().replaceUserId(e,t)}replaceUserIdForPrimaryUserId(e,t,s){this.getUserModel().replaceUserIdForPrimaryUserId(e,t,s)}sync(){this.getUserModel().sync()}getTutorialSteps(){return this.getUserModel().getTutorialSteps()}insertTutorStep(e){this.getUserModel().insertTutorStep(e)}setIsUserPay(){this.getUserModel().setIsUserPay()}isPayingUser(){return this.getUserModel().isPayingUser()}canBalanceSentTime(){return this.getUserModel().canBalanceSentTime()}refreshBalanceSentTime(){this.getUserModel().refreshBalanceSentTime()}turnOffRef(){this.getUserModel().turnOffRef()}isTurnOnRef(){return this.getUserModel().isTurnOnRef()}getRg(){return this.getUserModel().getRg()}clearCard(){this.getUserModel().clearCard()}lastActive(){return this.getUserModel().lastActive()}setAttr(e,t){this.getUserModel().setAttr(e,t)}getUserCard(){return this.getUserModel().getCard()}getPrimaryIdByCondition(e){return this.getUserModel().findPrimaryIdByCondition(e)}findUserByPrimaryId(e){return this.getUserModel().findUserByPrimaryId(e)}getActiveExperiment(){return this.getUserModel().getActiveExperiment()||null}clearActiveExperiment(){this.getUserModel().clearActiveExperiment()}getExperiments(){return this.getUserModel().getExperiments()}getRemoteConfig(){return this.getUserModel().getRemoteConfig()}getActiveRemoteConfig(){return this.getUserModel().getRemoteConfig()?.getActiveRemoteConfig()||null}setActiveRemoteConfig(e){this.getUserModel().getRemoteConfig()?.setActiveRemoteConfig(e||null)}checkRefusedExperiment(e){return this.getUserModel().getRefusedExperiments().includes(e)||!1}getRefusedExperiments(){return this.getUserModel().getRefusedExperiments()||[]}getIsMigrated(){return this.getUserModel().getIsMigrated()}setIsMigrated(e){this.getUserModel().setAttr(G.isMigrated,e)}getUsersList(){return this.getUserModel().getUsersList()}}class Et{constructor(e,t,s){this.appId=e,this.platformKey=t,this.storage=s,this.getAppModel().init()}getAppModel(){return this.storage.getAppModel()}getUUID(){return this.getAppModel().getUUID()||""}getAppVer(){return this.getAppModel().getAppVer()}getExcludeVer(){return this.getAppModel().getExcludeVer()}setAppVer(e){this.getAppModel().setAppVer(e),L.info('App version "{version}" is set successfully',{version:this.getAppModel().getAppVer()})}setConfigSdk(e){this.getAppModel().setConfigSdk(e)}getAliveTimeout(){return this.getAppModel().getAliveTimeout()}getTimeForRequest(){return this.getAppModel().getTimeForRequest()}getCATimeout(){return this.getAppModel().getCATimeout()}getSessionTimeout(){return this.getAppModel().getSessionTimeout()}isAllExcluded(){return this.getAppModel().isAllExcluded()}getEventsExcluded(){return this.getAppModel().getEventsExcluded()}getCountForRequest(){return this.getAppModel().getCountForRequest()}getMaxEventParams(){return this.getAppModel().getMaxEventParams()}getTransactionIds(){return this.getAppModel().getTransactionIds()}addTransactionId(e){this.getAppModel().addTransactionId(e)}getAppId(){return this.appId}getPlatformKey(){return this.platformKey}sync(){this.getAppModel().sync()}}class Ct{constructor(e,t,s,r,i,n,a){this.validator=new ke,this.appManager=t,this.userManager=s,this.progressionManager=r,this.eventQueueManager=i,this.systemManager=n,this.remoteConfigManager=a??null,this.storage=e}getEventModel(){return this.storage.getEventModel()}createEvent(e,t){let s=Date.now();e===g.SS_CODE&&(s=this.userManager.getSessionId()),t[c.TIMESTAMP]=s;let r={[K.primaryUserId]:this.userManager.getPrimaryId(),[K.language]:this.systemManager.getLanguage(),[K.appVersion]:this.appManager.getAppVer(),[K.sdkVersion]:this.systemManager.getSdkVer(),[K.sdkCodeVersion]:this.systemManager.getSdkVerCode(),[K.engine]:this.systemManager.getEngine(),[K.code]:e};return r=Object.fromEntries(Object.entries(r).filter(([e,t])=>!x.isNullOrEmpty(t))),r[K.params]=t,r}generateEvent(e,t,s="system"){const r=this.validator.validEvent(e,t,s,{steps:this.userManager.getTutorialSteps(),trIds:this.appManager.getTransactionIds(),maxCeParams:this.appManager.getMaxEventParams()});if(e!=g.TS_CODE&&!this.userManager.isTracking())return L.info("Event [{code}] not created. Tracking is Disabled",{code:e}),void this.afterGenerateEvent(e,r);let i=!1;if(this.checkedEvent(e,r)){this.beforeGenerateEvent(e,r),i=-1!==[g.RP_CODE,g.TS_CODE,g.AL_CODE,g.LU_CODE,g.PE_CODE,g.SS_CODE,g.RF_CODE,"tstr","ch"].indexOf(e);const t=this.createEvent(e,r);L.info("Create new event: "+JSON.stringify(t[K.params],null,2)),e===g.AL_CODE?this.eventQueueManager.add(e,t):this.getEventModel().addEvent(t),this.afterGenerateEvent(e,r),(i||this.getCountEvents()>=this.appManager.getCountForRequest())&&this.sendEvents()}}afterGenerateEvent(e,t){switch(e){case g.LU_CODE:this.userManager.setLevel(t[c.LEVEL]||0);break;case g.TR_CODE:this.userManager.insertTutorStep(t[c.STEP]||0);break;case g.RP_CODE:this.appManager.addTransactionId(t[c.ORDER_ID]||""),this.userManager.setIsUserPay(),this.remoteConfigManager&&this.remoteConfigManager.audienceState.updateAudienceState({[d]:!0},!0);break;case g.CB_CODE:this.userManager.refreshBalanceSentTime()}}beforeGenerateEvent(e,t){const s=this.userManager.isTracking();t[c.CODE]=e;const r=this.progressionManager.getLocation();switch(r&&![g.DI_CODE,g.PL_CODE,g.RF_CODE,g.PE_CODE,g.AL_CODE,g.CA_CODE,g.CB_CODE,"tstr","ch"].includes(e)&&(t[c.IN_PROGRESS]=[r]),[g.DI_CODE,g.TR_CODE,g.LU_CODE,g.AL_CODE,g.RF_CODE,g.ADRV_CODE].includes(e)||(t[c.LEVEL]=this.userManager.getLevel()),[g.DI_CODE,g.TR_CODE,g.SS_CODE,g.AL_CODE].includes(e)||(t[c.SESSION_ID]=this.userManager.getSessionId()),e){case g.TS_CODE:t.allowed||(this.getEventModel().removeByPrimaryUserId(this.userManager.getPrimaryId()),this.userManager.clearCA(),this.userManager.clearBackendId(),this.generateUserEngagement(),this.generatePeopleEvent()),this.userManager.setTracking(t.allowed);break;case g.LU_CODE:if(s){const e=this.userManager.getCA();e&&Object.keys(e).length>0&&this.generateEvent(g.CA_CODE,e),this.remoteConfigManager&&this.remoteConfigManager.audienceState.updateAudienceState({level:t[c.LEVEL]},!1)}break;case g.CA_CODE:s&&this.userManager.clearCA();break;case g.RF_CODE:s&&this.userManager.turnOffRef()}this.remoteConfigManager&&!this.remoteConfigManager.getIsInActiveState()&&e!==g.AL_CODE&&this.remoteConfigManager.searchSuitableExperiment(t)}checkedEvent(e,t){return!this.isAllExcluded()&&(e!==g.RF_CODE||this.userManager.isTurnOnRef()?e!==g.CB_CODE||this.userManager.canBalanceSentTime()?e===g.LU_CODE&&this.userManager.getLevel()==t[c.LEVEL]?(L.info("The current level is equal to the new level [{level}]",{level:t[c.LEVEL]}),!1):!this.validator.isExcluded(this.appManager.getEventsExcluded(),e,t):(L.info("The CurrentBalance event has already been sent less than 4 hours ago."),!1):(L.info("Referral data of the current user is already sent"),!1))}isAllExcluded(){return!!this.appManager.isAllExcluded()&&(L.info("All events are excluded by project configuration"),!0)}getCountEvents(){return this.getEventModel().getCountEventsByUser(this.userManager.getPrimaryId())}generateUserEngagement(){if(this.userManager.getSessionLength()>0){const e={[c.LENGTH]:this.userManager.getSessionLength()};this.userManager.clearSessionLength(),this.generateEvent(g.UE_CODE,e)}else L.debug("The user engagement event was not generated, session length is zero")}sendEvents(e){this.generatePeopleEvent(),this.generateCurrencyAccrual(),this.eventQueueManager.send(e)}addEvent(e,t={},s){this.generateEvent(e,t,s)}removeByPrimaryUserId(e){this.getEventModel().removeByPrimaryUserId(e)}getCountEventsByUser(e){return this.getEventModel().getCountEventsByUser(e)}getEventsByUser(e){return this.getEventModel().getEventsByUser(e)}removeByPrimaryIds(e){this.getEventModel().removeByPrimaryIds(e)}generatePeopleEvent(e=!1){const t=e?this.userManager.getCard():this.userManager.getCardChanges();if(t&&Object.keys(t).length>0){const e={parameters:t};return this.userManager.clearCardChanges(),this.generateEvent(g.PL_CODE,e)}}generateCurrencyAccrual(){const e=this.userManager.getCA();e&&Object.keys(e)?.length>0&&this.generateEvent(g.CA_CODE,e)}}class yt{constructor(e,t,s,r,i,n,a){if(this.systemManager=e,this.userManager=t,this.appManager=s,this.storageManager=r,this.eventQueueManager=i,this.remoteConfigListener=n,this.unityConfigListener=a,this.schedulers={},this.remoteConfigToApply=null,this.remoteConfigApplied=null,this.suitableExperiments=[],this.candidateExperiment=null,this.markedExperiments={},this._isGroupWaitingTaskRunning=!1,this._isABLogicStopped=!1,this.hasChanged=!1,this._audienceState=new St(this.storageManager.getUserModel(),this.appManager,this.searchSuitableExperiment.bind(this)),!this.checkStorageAvailability())return L.debug("[Remote Config] Remote config cannot run on environments without access to permanent storage"),void(this._isABLogicStopped=!0);this.initGroupWaitingScheduler()}startAbTestLogic(){this._isABLogicStopped||this.getIsInActiveState()||(this.checkUserNeedsToMigrate(),this.audienceState.init(),this.deleteExpiredExperiments(),this.clearTestExperiment(),this.remoteConfigApplied=this.userManager.getActiveRemoteConfig(),this.remoteConfigApplied&&le.applyConfig(this.remoteConfigApplied),this.tryApplyActiveExperiment(),this.remoteConfigToApply||this.searchSuitableExperiment(),this.remoteConfigToApply||this._isGroupWaitingTaskRunning||this.tryApplyRemoteConfig())}checkUserNeedsToMigrate(){this.userManager.getIsMigrated()||this.migrateUserExperiments()}migrateUserExperiments(){const e=this.storageManager.getExperimentsModel().getExperiments(),t=this.userManager.getRefusedExperiments();Object.entries(e).forEach(([e,s])=>{this.userManager.getExperiments()?.insert({...s,isRefused:t.includes(e)})}),this.storageManager.getExperimentsModel().purgeItself(),this.userManager.setIsMigrated(!0)}searchSuitableExperiment(e={}){if(this._isABLogicStopped)return;const t=this.userManager.getExperiments()?.getAll();this.suitableExperiments=[],t?.forEach(t=>{this.markedExperiments[t.id]||t.isRefused||(t.isTesting?this.suitableExperiments.push(t.id):t.conditions?.length>0||this.checkExperiment(t,e)&&this.suitableExperiments.push(t.id))}),this.suitableExperiments.length>0&&(L.info("[Remote Config] Suitable experiment found!"),this.handleSuitableExperiments())}onBlur(){this._isABLogicStopped||(this.candidateExperiment?(this.markedExperiments[this.candidateExperiment.id]="temporaryProcessed",this._isGroupWaitingTaskRunning=!1,L.warning(`[Remote Config] Offer refused because application entered background: ${this.candidateExperiment.id}`)):this.suitableExperiments.length>0&&(this.suitableExperiments.forEach(e=>{this.markedExperiments[e]="temporaryProcessed"}),L.warning(`[Remote Config] Offer request aborted, suitable experiments ${this.suitableExperiments.join(",")} canceled!`)),this.offerRequest.pause())}onFocus(){this._isABLogicStopped||this.startAbTestLogic()}changeUser(){this.stopGroupWaitingTask(),this.markedExperiments={},this.suitableExperiments=[],this.eventQueueManager.removeActiveAbTest(),this.candidateExperiment=null,this.remoteConfigToApply=null,this.remoteConfigApplied=null,this.audienceState.reInit(),this.startAbTestLogic()}get audienceState(){return this._audienceState}getIsInActiveState(){return null!==this.remoteConfigApplied}getIsGroupWaiting(){return this._isGroupWaitingTaskRunning}handleConfigReceived(e){e.experiments?.forEach(e=>{this.userManager.getExperiments()?.update(e)});const t=this.userManager.getRemoteConfig()?.getRemoteVersion(),s=this.userManager.getExperiments()?.getExperimentsVersion();if(this.userManager.getRemoteConfig()?.setRemoteVersion(e.remoteVersion),this.userManager.getExperiments()?.setExperimentsVersion(e.experimentsVersion),e.remoteVersion!==t&&(x.isNullOrEmpty(e.remoteDefault)||this.userManager.getRemoteConfig()?.setConfigDefault(e.remoteDefault),x.isNullOrEmpty(e.remote)||this.userManager.getRemoteConfig()?.updateConfig(e.remote),this.hasChanged=!0),s!==e.experimentsVersion){const t=[];Object.entries(e.experiments??{}).forEach(([e,s])=>{this.userManager.getExperiments()?.update(s),t.push(e)}),t.length>0&&Object.keys(this.userManager.getExperiments()?.getAll()||{}).forEach(e=>{t.includes(e)||this.userManager.getExperiments()?.remove(e)}),this.hasChanged=!0}this.audienceState.updateAudienceState(e.userData,!1),this.deleteExpiredExperiments(),this._isGroupWaitingTaskRunning||this.searchSuitableExperiment(),this._isGroupWaitingTaskRunning||this.tryApplyRemoteConfig()}applyConfig(){this._isABLogicStopped?L.info("[Remote Config] Remote config cannot be applied because AB logic is stopped"):this.getIsInActiveState()?L.info("[Remote Config] Remote config has already been applied"):this.remoteConfigToApply?(L.debug("[Remote Config] Applying remote config"),le.applyConfig(this.remoteConfigToApply.getData()),this.userManager.setActiveRemoteConfig(this.remoteConfigToApply?.getData()),this.remoteConfigToApply=null,this.hasChanged=!1):L.error("[Remote Config] Remote config is empty")}resetConfig(){L.debug("[Remote Config] Remote config was reset"),this.resetAndWait()}invalidateConfig(){L.debug("[Remote Config] Remote config was invalidated"),this.invalidateAndWait()}tryApplyActiveExperiment(){const e=this.userManager.getActiveExperiment();if(!e)return;const t=this.userManager.getExperiments()?.get(e.id);t?this.eventQueueManager.setActiveAbTest({id:t.id,group:e.group}):(this.userManager.clearActiveExperiment(),this.hasChanged=!0),this.tryApplyRemoteConfig()}tryApplyRemoteConfig(){const e=this.userManager.getRemoteConfig()?.getConfig(),t=this.userManager.getRemoteConfig()?.getConfigDefault(),s=this.userManager.getRemoteConfig()?.isInvalidated(),r=Mt.createFromConfig(le.defaults?.values||{});r.appendData(t&&!s?t:{},$.Remote),r.appendData(e&&!s?e:{},$.Remote),r.appendConfig(this.remoteConfigToApply?.getData()||{});const i=r.diff(this.remoteConfigApplied||{});this.remoteConfigToApply=r,i.keys.length>0&&this.hasChanged&&this.notifyChanged(i),this.hasChanged=!1}checkExperiment(e,t){return e.conditions?.forEach(e=>{const{code:s,type:r}=e;if(!r){if(s===g.PL_CODE)return this.checkingPeople(e,this.userManager.getCard());if(s===g.DI_CODE){const t=this._audienceState.getAudienceState();return this.checkParameters(e,t)}return!!t&&this.checkEvent(s,e,t)}return"backend"===r&&this.checkBackend(e)}),!1}checkingPeople(e,t){return 0!==Object.keys(e?.[c.PARAMETERS]??{}).length&&0!==Object.keys(t).length&&this.checkParameters(e[c.PARAMETERS],t)}checkEvent(e,t,s){if(!s||e!==s[c.CODE])return!1;return!Object.entries(t).filter(([e,t])=>{if("code"===e)return!1;const r=new Ue;return e===c.PARAMETERS?!this.checkParameters(t,s[c.PARAMETERS]):!r.checkConditions(t,s[e])})}checkBackend(e){const t=new Ue,s=this._audienceState.getAudienceState();return!Object.entries(e).filter(([r,i])=>{if("type"===r)return!1;const n=s[r];if(void 0===n)return!0;return!t.checkConditions(e,n)})}checkParameters(e,t){const s=new Ue;let r=!1;for(const[i,n]of Object.entries(e))if("code"!==i&&i!==c.PARAMETERS){if(!s.checkConditions(n,t[i])){r=!0;break}}return!r}initGroupWaitingScheduler(){this.schedulers.groupWaiting=new Pe("groupWaiting",()=>this.handleGroupWaitingTimeout(),le.groupDefinitionWaiting)}handleSuitableExperiments(){this.eventQueueManager.freeze(),this.runGroupWaitingTask(),this.startOfferRequest().then(e=>{if(this._isGroupWaitingTaskRunning)if(this.suitableExperiments=[],e?.id&&e?.group){L.info(`[Remote Config] Offer accept experiment id: ${e.id} group: ${e.group}`);const t=this.userManager.getExperiments()?.get(e.id);if(t){this.candidateExperiment=t,this.eventQueueManager.setActiveAbTest({id:t.id,group:e.group});const s=Mt.createFromData({},$.AbTest);t.parameters.forEach(t=>{s.set(t.key,t.values[e.group]||"",$.AbTest)}),this.remoteConfigToApply=s,this.hasChanged=!0}}else if(e?.id){const t=this.userManager.getExperiments()?.get(e.id);t&&this.userManager.getExperiments()?.update({...t,isRefused:!0})}}).catch(e=>{L.error("[Remote Config] Offer request failed:",e),this.tryApplyRemoteConfig()})}startOfferRequest(){return new Promise((e,t)=>{L.debug("[Remote Config] Trying to get offer from server"),0!==this.suitableExperiments.length?(this.offerRequest=new tt("offer",this.systemManager,this.userManager,this.appManager,s=>{s?.involvedExperiments?.length?e(s.involvedExperiments[0]):t(new Error("Server refused to conduct the experiment"))},e=>{e.body||(e.body={}),e.body.suitableExperiments=this.suitableExperiments}),this.offerRequest.start()):t(new Error("No suitable experiments"))})}runGroupWaitingTask(){this._isGroupWaitingTaskRunning=!0,le.groupDefinitionWaiting>0&&this.schedulers.groupWaiting?.start()}handleGroupWaitingTimeout(){this.candidateExperiment?(this._isGroupWaitingTaskRunning=!1,this.userManager.getExperiments()?.update({...this.candidateExperiment,isRefused:!0}),L.warning(`[Remote Config] Involved experiment ${this.candidateExperiment.id} was cancelled. Reason: time is over`)):this.suitableExperiments.length>0&&(this._isGroupWaitingTaskRunning=!1,this.suitableExperiments.forEach(e=>{const t=this.userManager.getExperiments()?.get(e);t&&this.userManager.getExperiments()?.update({...t,isRefused:!0})}),L.warning(`[Remote Config] Suitable experiments ${this.suitableExperiments.join(", ")} were cancelled. Reason: time is over`)),this.hasChanged=!1,this.tryApplyRemoteConfig()}terminate(){this.offerRequest&&this.offerRequest.clear();const e=this.userManager.getActiveExperiment()?.id||"";e&&(this.userManager.clearActiveExperiment(),this.markedExperiments[e]="processed");this.userManager.getActiveRemoteConfig()&&this.userManager.setActiveRemoteConfig(null),this.schedulers.groupWaiting?.stop(),this._isGroupWaitingTaskRunning=!1,this.remoteConfigToApply=null,this.candidateExperiment&&(this.markedExperiments[this.candidateExperiment.id]="processed"),this.suitableExperiments.length>0&&this.suitableExperiments.forEach(e=>{const t=this.userManager.getExperiments()?.get(e);t&&(this.markedExperiments[e]="processed")}),this.eventQueueManager.removeActiveAbTest(),this.eventQueueManager.unfreeze(),this.candidateExperiment=null,this.suitableExperiments=[],this.hasChanged=!1}resetAndWait(){this.terminate(),this.remoteConfigApplied=null,le.resetConfig(),L.info("[Remote Config] Default parameters were applied"),this.userManager.getRemoteConfig()?.clearAllConfigs(),this.searchSuitableExperiment()}invalidateAndWait(){this.terminate(),this.remoteConfigApplied=null,this.userManager.getRemoteConfig()?.invalidate(),le.resetConfig(),L.info("[Remote Config] Default parameters were applied"),this.searchSuitableExperiment()}deleteExpiredExperiments(){const e=this.userManager.getExperiments()?.getAll();if(!e)return;const t=Date.now();e.forEach(e=>{e.completionDate&&e.completionDate<=t&&this.userManager.getExperiments()?.remove(e.id)})}clearTestExperiment(){if(le.cacheTestExperiment)return;const e=this.userManager.getActiveExperiment()?.id||"",t=this.userManager.getExperiments()?.get(e);t&&t.isTesting&&this.userManager.getExperiments()?.update({...t,isRefused:!0})}checkStorageAvailability(){return this.storageManager.isAvailable()}notifyChanged(e){this.remoteConfigListener?.onChanged&&this.remoteConfigListener.onChanged(e),this.unityConfigListener?.onChanged&&this.unityConfigListener.onChanged({userCounting:this.userManager.isUserCounting()?1:0,activeUserId:this.userManager.getUserId(),usersData:JSON.stringify(this.userManager.getUsersList()),remoteConfigData:JSON.stringify(this.remoteConfigToApply?.getData()),updatedKeysData:JSON.stringify(e.keys)})}stopGroupWaitingTask(){this.schedulers.groupWaiting?.stop(),this._isGroupWaitingTaskRunning=!1}}class St{constructor(e,t,s){this.appManager=t,this.searchSuitableExperiment=s,this.data={},this.userModel=e}init(){this.data={},this.data.displayDiagonal=this.getDisplayResolution(),this.data.language=this.getLanguage(),this.data.lifetime=this.calculateLifetime();const e=this.userModel.getAttrByKey(G.currentLevel);e&&(this.data.level=e);const t=this.userModel.getAttrByKey(G.created);t&&(this.data.created=t);const s=this.userModel.getAttrByKey(G.isPayingUser);null!==s&&(this.data.payingUser=s);const r=this.userModel.getAttrByKey(G.newUser);null!==r&&(this.data.newUser=r);const i=this.appManager.getPlatformKey();i&&(this.data.platformKey=i)}reInit(){this.init()}getAudienceState(){return this.data.lifetime=this.calculateLifetime(),{...this.data}}updateAudienceState(e,t=!1){Object.entries(e).forEach(([e,t])=>{null!=t&&(this.data[e]=t)}),t&&this.searchSuitableExperiment()}getDisplayResolution(){return this.data.displayDiagonal??"unknown"}getLanguage(){return this.data.language??"en"}calculateLifetime(){return this.data.created?Date.now()-new Date(this.data.created).getTime():0}}class Mt{constructor(e,t){this.data={},Object.entries(e||{}).forEach(([e,s])=>{this.data[e]="object"==typeof s?{value:s.value,source:s.source}:{value:s,source:t}})}static createFromData(e,t){return new Mt(e,t)}static createFromConfig(e){return new Mt(e,null)}set(e,t,s){this.data[e]={value:t,source:s}}getData(){return this.data}appendData(e,t){Object.entries(e||{}).forEach(([e,s])=>{this.data[e]={value:s,source:t}})}appendConfig(e){Object.entries(e||{}).forEach(([e,t])=>{this.data[e]={value:t.value,source:t.source}})}diff(e){const t={keys:[]},s={...e};return Object.entries(this.data).forEach(([r,i])=>{JSON.stringify(i.value)!==JSON.stringify(e[r]?.value)&&i?.source!==$.Defaults&&t.keys.push({key:r,source:Q[i.source]}),delete s[r]}),Object.keys(s).length>0&&Object.entries(s).forEach(([e,s])=>{t.keys.push({key:e,source:Q[s.source]})}),t}}class At{constructor(){this.progress={},this.name=null,this.location=null}start(e,t={}){return this.clear(),this.name=e,this.location=t[c.SOURCE]??this.name,this.progress={startTime:Date.now(),startBundle:t},L.info("[Progression] Event '{name}' is started",{name:this.name}),!0}finish(e,t={}){if(null===this.name)return L.warning("[Progression] Event can't be finished! Doesn't have any started progression events"),!1;if(this.name===e){L.info("[Progression] Event '{name}' is finished",{name:e});const s={[c.NAME]:e,[c.PARAMETERS]:{}};if(void 0!==this.progress.startBundle[c.SOURCE]&&(s[c.PARAMETERS][c.SOURCE]=this.progress.startBundle[c.SOURCE]),s[c.PARAMETERS][c.SUCCESSFUL_COMPLETION]=t[c.SUCCESSFUL_COMPLETION],void 0===t[c.DURATION]){const e=Math.ceil((Date.now()-this.progress.startTime)/1e3);e>0&&(s[c.PARAMETERS][c.DURATION]=e)}else s[c.PARAMETERS][c.DURATION]=t[c.DURATION];return void 0!==this.progress.startBundle[c.DIFFICULTY]&&(s[c.PARAMETERS][c.DIFFICULTY]=this.progress.startBundle[c.DIFFICULTY]),void 0!==t[c.EARNED]&&(s[c.PARAMETERS][c.EARNED]=t[c.EARNED]),void 0!==t[c.SPENT]&&(s[c.PARAMETERS][c.SPENT]=t[c.SPENT]),this.progress={},this.name=null,this.location=null,s}return L.warning("[Progression] Event can't be finished!\n\tStarted progression event name is [{currentName}]\n\tCurrent event name is [{name}]",{currentName:this.name,name:e}),!1}getLocation(){return this.location}clear(){this.progress={},null!==this.name&&L.info("[Progression] Event [{name}] is cleared",{name:this.name}),this.name=null,this.location=null}}class Tt{constructor(){this.options={pageLoad:!1,click:!1,scroll:!1},this.excludeSelectors=["input[type=password]","input[type=email]","input[type=tel]","input[type=number]","input[type=search]","[data-sensitive]","[class*=sensitive]","[id*=sensitive]","[class*=private]","[id*=private]","[autocomplete=cc-number]","[autocomplete=cc-exp]","[autocomplete=cc-csc]"],this.redactTextContent=!0,this.sensitiveTextPatterns=[/[^@\s]+@[^@\s]+\.[^@\s]+/,/\b(?:\d[ -]*?){13,16}\b/,/\b\d{1,3}\.\d{1,3}\.\d{1,9}\b/,/\b\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,9}\b/],this.STRING_LIMITS={URL:2048,TITLE:500,PATH:1e3,REFERRER:2048,TEXT:100,ID:100,CLASS:500},this.isStarted=!1,this.scrollPoints=[25,50,75,100],this.maxScroll=0,this.reportedScrollPoints={},this.lastPageData=null,this.mutationObserver=null,this.mutationTimeout=null,this.lastMutationTime=0,this.isInitialized=!1,this.boundPopStateHandler=null,this.boundPushStateHandler=null,this.boundReplaceStateHandler=null,this.handleClick=e=>{if(!this.options.click)return;const t=e.target;if(t){this.getElementDetails(t)}},this.handleScroll=()=>{if(!this.options.scroll)return;const e=this.calculateScrollPercent();if(e>this.maxScroll){this.maxScroll=e;for(let t=0;t<this.scrollPoints.length;t++){const s=this.scrollPoints[t]||0;if(e>=s&&this.maxScroll>=s&&!this.reportedScrollPoints[s]){this.reportedScrollPoints[s]=!0;window.location.href,document.title,window.location.hostname,window.location.pathname}}}}}getPageLoadTime(){if(!window.performance||!window.performance.getEntriesByType)return null;try{const e=performance.getEntriesByType("navigation")[0];if(e)return Math.round(e.loadEventEnd);const t=performance.getEntriesByType("paint");if(t&&t.length)return Math.round(t[0]?.startTime||0)}catch(e){}return null}truncateString(e,t=2048){return e?e.length<=t?e:e.substring(0,t):null}getPageData(){return{URL:this.truncateString(window.location.href,this.STRING_LIMITS.URL)||"",Referrer:this.truncateString(document.referrer,this.STRING_LIMITS.REFERRER),Title:this.truncateString(document.title,this.STRING_LIMITS.TITLE)||"",Hostname:this.truncateString(window.location.hostname,this.STRING_LIMITS.URL)||"",Path:this.truncateString(window.location.pathname,this.STRING_LIMITS.PATH)||"",Hash:this.truncateString(window.location.hash,this.STRING_LIMITS.PATH)||"",Search:this.truncateString(window.location.search,this.STRING_LIMITS.PATH)||"",PageLoadTime:this.getPageLoadTime()}}shouldTrackPageChange(e){return!this.lastPageData||(this.lastPageData.Path!==e.Path||this.lastPageData.Hash!==e.Hash||this.lastPageData.Search!==e.Search||this.lastPageData.Title!==e.Title)}handlePageView(e){if(!this.options.pageLoad)return;const t=this.getPageData();this.shouldTrackPageChange(t)&&(t.Source=e,this.lastPageData=t,this.maxScroll=0,this.reportedScrollPoints={})}setupMutationObserver(){window.MutationObserver&&(this.mutationObserver=new MutationObserver(e=>{const t=Date.now();if(t-this.lastMutationTime<1e3)return this.mutationTimeout&&clearTimeout(this.mutationTimeout),void(this.mutationTimeout=window.setTimeout(()=>{this.checkForPageChange()},1e3));this.lastMutationTime=t,this.checkForPageChange()}),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0}))}checkForPageChange(){const e=this.getPageData();this.shouldTrackPageChange(e)&&this.handlePageView("mutation")}isSensitiveElement(e){return this.excludeSelectors.some(t=>e.matches(t))}hasSensitiveParent(e){let t=e.parentElement;for(;t;){if(this.isSensitiveElement(t))return!0;t=t.parentElement}return!1}redactSensitiveText(e){if(!e||!this.redactTextContent||!this.sensitiveTextPatterns)return e;let t=e;return this.sensitiveTextPatterns.forEach(e=>{t=t.replace(e,"[REDACTED]")}),t}getElementDetails(e){if(this.isSensitiveElement(e)||this.hasSensitiveParent(e))return{"Element tag":e.tagName.toLowerCase(),"Is sensitive":!0};const t=e.textContent||e.innerText||e.value||"",s=this.getPageData();return{URL:s.URL,Path:s.Path,Hostname:s.Hostname,Title:s.Title,Href:this.truncateString(e.getAttribute("href"),this.STRING_LIMITS.URL),"Element tag":this.truncateString(e.tagName.toLowerCase())||"","Element Text":this.redactSensitiveText(this.truncateString(t,this.STRING_LIMITS.TEXT)||""),"Element ID":this.truncateString(e.id),"Element Class":this.truncateString(e.className,this.STRING_LIMITS.CLASS)}}calculateScrollPercent(){const e=document.documentElement,t=document.body,s="scrollTop",r="scrollHeight",i=(e[s]||t[s])/((e[r]||t[r])-e.clientHeight)*100;return Math.floor(i)}addEventListeners(){if(this.options.pageLoad){this.handlePageView("load"),this.boundPopStateHandler=e=>{this.handlePageView("popstate")},window.addEventListener("popstate",this.boundPopStateHandler);const e=e=>{const t=window.history[e];return function(...s){const r=t.apply(this,s),i=new Event(e);return window.dispatchEvent(i),r}};window.history.pushState=e("pushState"),window.history.replaceState=e("replaceState"),this.boundPushStateHandler=e=>{this.handlePageView("pushState")},this.boundReplaceStateHandler=e=>{this.handlePageView("replaceState")},window.addEventListener("pushState",this.boundPushStateHandler),window.addEventListener("replaceState",this.boundReplaceStateHandler),this.setupMutationObserver()}this.options.click&&document.addEventListener("click",this.handleClick),this.options.scroll&&document.addEventListener("scroll",this.handleScroll)}removeEventListeners(){document.removeEventListener("click",this.handleClick),document.removeEventListener("scroll",this.handleScroll),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.mutationTimeout&&(clearTimeout(this.mutationTimeout),this.mutationTimeout=null),this.boundPopStateHandler&&(window.removeEventListener("popstate",this.boundPopStateHandler),this.boundPopStateHandler=null),this.boundPushStateHandler&&(window.removeEventListener("pushState",this.boundPushStateHandler),this.boundPushStateHandler=null),this.boundReplaceStateHandler&&(window.removeEventListener("replaceState",this.boundReplaceStateHandler),this.boundReplaceStateHandler=null),this.lastPageData=null,this.maxScroll=0,this.reportedScrollPoints={}}start(){!this.isStarted&&this.isInitialized&&(this.isStarted=!0,this.addEventListeners())}stop(){this.isStarted&&this.isInitialized&&(this.isStarted=!1,this.removeEventListeners())}init(e){if("object"==typeof e){e.click&&e.click.excludeSelectors&&(e.click.excludeSelectors=this.excludeSelectors.concat(e.click.excludeSelectors.filter(e=>this.excludeSelectors.indexOf(e)<0))),e.click&&e.click.sensitiveTextPatterns&&(e.sensitiveTextPatterns=this.sensitiveTextPatterns.concat(e.sensitiveTextPatterns.filter(e=>this.sensitiveTextPatterns.indexOf(e)<0)));for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&void 0!==this.options[t]&&(this.options[t]=e[t]);this.isInitialized=!0}}}class It{constructor(e,t){this.sdk=e,this.pluginName=t}get isNewSession(){return this.sdk.isNewSession}addEvent(e,t,s){this.sdk.addEvent(e,t,s)}sendEvents(){this.sdk.sendEvents()}setAppVer(e,t){this.sdk.setAppVer(e,t)}getUserCardField(e,t){return this.sdk.getUserCardField(e,t)}setUserCardField(e,t,s){this.sdk.setUserCardField(e,t,s)}unsetUserCardFields(e,t){this.sdk.unsetUserCardFields(e,t)}clearUserCard(){this.sdk.clearUserCard()}startPe(e,t,s){this.sdk.startPe(e,t,s)}stopPe(e,t,s){this.sdk.stopPe(e,t,s)}setCA(e,t,s,r,i){this.sdk.setCA(e,t,s,r,i)}get systemManager(){return{getSdkVer:()=>this.sdk.systemManager.getSdkVer(),getAppId:()=>this.sdk.systemManager.getAppId(),getUA:()=>this.sdk.systemManager.getUA(),getLanguage:()=>this.sdk.systemManager.getLanguage(),getOsName:()=>this.sdk.systemManager.getOsName(),getOsVer:()=>this.sdk.systemManager.getOsVer(),getDisplayResolution:()=>this.sdk.systemManager.getDisplayResolution(),getEngine:()=>this.sdk.systemManager.getEngine()}}setTracking(e,t){this.sdk.setTracking(e,t)}setLevel(e,t){this.sdk.setLevel(e,t)}get storage(){return{getUserModel:()=>this.sdk.storageManager.getUserModel(),getAppModel:()=>this.sdk.storageManager.getAppModel(),getEventModel:()=>this.sdk.storageManager.getEventModel(),getPluginModel:()=>this.sdk.storageManager.getPluginModel()}}getPluginStorage(){return this.sdk.storageManager.getPluginModel().getPluginData(this.pluginName)}getPluginField(e){return this.sdk.storageManager.getPluginModel().getPluginField(this.pluginName,e)}setPluginField(e,t){this.sdk.storageManager.getPluginModel().setPluginField(this.pluginName,e,t)}removePluginField(e){this.sdk.storageManager.getPluginModel().removePluginField(this.pluginName,e)}clearPluginStorage(){this.sdk.storageManager.getPluginModel().clearPluginData(this.pluginName)}get userManager(){return{getUserId:()=>this.sdk.userManager.getUserId(),getSessionId:()=>this.sdk.userManager.getSessionId()}}get appManager(){return{getAppId:()=>this.sdk.appManager.getAppId()}}get logger(){return{error:(e,t)=>L.error(e,t),warning:(e,t)=>L.warning(e,t),info:(e,t)=>L.info(e,t),debug:(e,t)=>L.debug(e,t)}}get api(){return{sendRequest:(e,t,s,r)=>{if(!this.validateApiRequest(t))return void s(0,null,new Error("Invalid API request"));const i={...t,auxiliary:{...t.auxiliary,plugin_name:"plugin_request",plugin_timestamp:Date.now()}};this.logger.debug("Plugin API request",{key:e,url:t.url,method:t.method||"POST"}),_e.run(e,i,s,r)},stopRequest:e=>{_e.stop(e),this.logger.debug("Plugin API request stopped",{key:e})},buildUrl:(e,t,s)=>this.sdk.systemManager.buildUrl(e,t||{},s||void 0),createRequestStructure:(e,t,s,r="POST")=>({method:r,url:e,headers:s||{},body:t||{},auxiliary:{plugin_request:!0,timestamp:Date.now()},toBase64:[]})}}validateApiRequest(e){try{if(!e.url||"string"!=typeof e.url)return this.logger.error("Invalid API request: missing or invalid URL"),!1;const t=new URL(e.url);if(!["https:","http:"].includes(t.protocol))return this.logger.error("Invalid API request: unsupported protocol",{protocol:t.protocol}),!1;if(e.headers&&"object"!=typeof e.headers)return this.logger.error("Invalid API request: headers must be an object"),!1;if(void 0!==e.body)try{JSON.stringify(e.body)}catch{return this.logger.error("Invalid API request: body is not serializable"),!1}return!0}catch(e){return this.logger.error("Invalid API request: validation error",{error:e}),!1}}}class bt{constructor(e,t,s){this.plugins=new Map,this.isStarted=!1,this.sdk=e,this.storageManager=t,this.config=s}register(e){if(this.plugins.has(e.name))L.error(`Plugin '${e.name}' is already registered`);else{if(e.dependencies)for(const t of e.dependencies)this.plugins.has(t)||L.error(`Plugin '${e.name}' requires dependency '${t}' which is not registered`);if(this.plugins.set(e.name,e),!this.sdk)return L.error(`Plugin '${e.name}' is not registered because SDK is not initialized`),void this.plugins.delete(e.name);{const t=this.storageManager.getPluginModel().getPluginData(e.name);e.init(new It(this.sdk,e.name),this.config,t),this.isStarted&&e.start()}}}unregister(e){const t=this.plugins.get(e);t&&(t.destroy(),this.plugins.delete(e))}getPlugin(e){return this.plugins.get(e)||null}getAllPlugins(){return Array.from(this.plugins.values())}start(){this.isStarted=!0,this.plugins.forEach(e=>{e.start()})}stop(){this.isStarted=!1,this.plugins.forEach(e=>e.stop())}onEvent(e,t){this.plugins.forEach(s=>{s.onEvent&&s.onEvent(e,t)})}onUserChange(e){this.plugins.forEach(t=>{t.onUserChange&&t.onUserChange(e)})}onSessionStart(){this.plugins.forEach(e=>{e.onSessionStart&&e.onSessionStart()})}onSessionEnd(){this.plugins.forEach(e=>{e.onSessionEnd&&e.onSessionEnd()})}onFocus(){this.plugins.forEach(e=>{e.onFocus&&e.onFocus()})}onBlur(){this.plugins.forEach(e=>{e.onBlur&&e.onBlur()})}onBeforeUnload(){this.plugins.forEach(e=>{e.onBeforeUnload&&e.onBeforeUnload()})}onTrackingChange(e){this.plugins.forEach(t=>{t.onTrackingChange&&t.onTrackingChange(e)})}}class kt{constructor(){this.timer=Re.getInstance(),this.isConnected=!1,this.validator=new ke,this.sdkVersion="3.0.0-beta.3",this.progressionManager=new At,this.remoteConfigManager=null,this.schedulers={},this.isNewSession=!1,this.storageManager=new dt,this.systemManager=new pt({apiUrl:"https://statgw.devtodev.com",dataApiUrl:"https://api.devtodev.com",sdkVersion:this.sdkVersion,sdkVersionCode:parseInt(this.sdkVersion.replace(/\D/g,"")||"0"),engine:"Native",base64:!0}),this.autocapture=new Tt,this.eventListenersManager=new ft(this.onBlur.bind(this),this.onFocus.bind(this),this.onFullScreenChange.bind(this),this.onBeforeUnload.bind(this)),this.autocapture=new Tt}initUser(e){if(this.userManager.init(e.userId??null),void 0!==e[o]){const t=e[o],s=this.userManager.isTracking();this.validator.validTracking("Initialize",t)&&(s===t&&!1!==t||this.eventManager.addEvent(g.TS_CODE,{allowed:t}))}if(void 0!==e.currentLevel){const t=e.currentLevel;this.validator.validLevel("Initialize",t)&&this.userManager.setLevel(t)}}initSDK(e,t,s,r,i){this.systemManager.setAppId(e),s?.apiCustomUrl&&this.systemManager.setApiUrl(s.apiCustomUrl),this.storageManager.init(e,{base64:this.systemManager.isBase64()}),this.appManager=new Et(e,t,this.storageManager),this.userManager=new vt(this.storageManager,this.appManager),this.eventQueueManager=new Be(this.systemManager,this.userManager,this.storageManager,this.appManager),r&&(this.remoteConfigManager=new yt(this.systemManager,this.userManager,this.appManager,this.storageManager,this.eventQueueManager,r,i)),this.eventManager=new Ct(this.storageManager,this.appManager,this.userManager,this.progressionManager,this.eventQueueManager,this.systemManager,this.remoteConfigManager??null),this.pluginManager=new bt(this,this.storageManager,s),this.schedulers.session=new Pe("session",this.onCallbackSessionTick.bind(this),5e3),this.schedulers.alive=new Pe("alive",this.onCallbackAliveTimeout.bind(this),this.appManager.getAliveTimeout()),this.schedulers.queue=new Pe("queue",this.onCallbackEventQueue.bind(this),this.appManager.getTimeForRequest()),this.schedulers.ca=new Pe("ca",this.onCallbackCurrencyAccrual.bind(this),this.appManager.getCATimeout()),this.configManagerSdk=new tt("sdk",this.systemManager,this.userManager,this.appManager,e=>{const t=this.userManager.isUserCounting();this.appManager.setConfigSdk(e),this.schedulers.alive?.setDelay(this.appManager.getAliveTimeout()),this.schedulers.ca?.setDelay(this.appManager.getCATimeout()),this.schedulers.queue?.setDelay(this.appManager.getTimeForRequest());const s=this.systemManager.getCountingTypeCallback();s&&t!==e.userCounting&&s(e.userCounting?1:0),L.debug("The SDK analytics configuration has been received: "+JSON.stringify(e,null,2))},()=>{L.debug("Try get analytics configuration from server")}),this.configManagerD2dId=new tt(this.remoteConfigManager?"remote":"d2dId",this.systemManager,this.userManager,this.appManager,e=>{this.remoteConfigManager?(this.remoteConfigManager.handleConfigReceived(e),this.userManager.setUserD2dIdData(e.userData)):this.userManager.setUserD2dIdData(e);const t=this.userManager.getD2dId(),s=this.systemManager.getCallbackDId();s&&s(t)},e=>{L.debug("Try get D2dId configuration from server"),this.remoteConfigManager&&(e.body||(e.body={}),e.body={...e.body,sdkBody:{remoteVersion:this.userManager.getRemoteConfig()?.getRemoteVersion()||0,experimentsVersion:this.userManager.getExperiments()?.getExperimentsVersion()||0,sdkVersion:this.systemManager.getSdkVer(),sdkCodeVersion:this.systemManager.getSdkVerCode(),appVersion:this.appManager.getAppVer()},userCard:{locale:this.remoteConfigManager.audienceState.getLanguage(),levelId:this.userManager.getLevel(),osVersion:this.systemManager.getOsVer()}})})}generateUserEngagement(){if(this.userManager.getSessionLength()>0){const e={length:this.userManager.getSessionLength()};this.userManager.clearSessionLength(),this.eventManager.addEvent(g.UE_CODE,e)}else L.debug("The user engagement event was not generated, session length is zero")}generateReferral(){if(this.userManager.isTurnOnRef())try{const e={utm_source:"utm_source",utm_medium:"utm_medium",utm_content:"utm_content",utm_campaign:"utm_campaign",utm_term:"utm_term"},t={};let s=!0;const r=window.document.URL;Object.keys(e).forEach(i=>{const n=x.parseUrlParams(r,i);null!=n&&""!==n&&(t[e[i]]=n,s=!1)}),s||this.eventManager.addEvent(g.RF_CODE,t)}catch{}}generateDeviceInfoForUser(){const e={[c.OS_VERSION]:this.systemManager.getOsVer(),[c.DISPLAY_RESOLUTION]:this.systemManager.getDisplayResolution(),[c.OS]:this.systemManager.getOsName(),[c.UUID]:this.appManager.getUUID(),[c.USER_AGENT]:this.systemManager.getUA(),[c.TIME_ZONE_OFFSET]:this.systemManager.getTzOffset()};return this.eventManager.addEvent(g.DI_CODE,e)}generateCheater(e){const t={timestamp:Date.now(),cheater:e};this.eventManager.addEvent(g.CH_CODE,t)}generateTester(e){const t={timestamp:Date.now(),tester:e};this.eventManager.addEvent(g.TSTR_CODE,t)}onBlur(){this.userManager.isTracking()&&this.checkConnection()&&(this.remoteConfigManager&&this.remoteConfigManager.getIsGroupWaiting()&&!this.remoteConfigManager.getIsInActiveState()&&this.remoteConfigManager.onBlur(),this.pluginManager.onBlur(),this.userManager.incrementSession(),this.generateUserEngagement(),this.sendExistingEvents(),this.timer.pause(),this.pauseAllSchedulers(),this.configManagerD2dId.pause(),this.configManagerSdk.pause(),this.eventQueueManager.pause())}onFocus(){this.checkConnection()&&(this.appManager.sync(),this.userManager.sync(),this.userManager.isTracking()&&(this.timer.start(),Object.keys(this.schedulers).forEach(e=>{this.schedulers[e]?.start()}),this.startOrResumeSession(),this.configManagerSdk.start(),this.userManager.haveBackendId()||this.configManagerD2dId.start(),this.pluginManager.onFocus()),this.eventQueueManager.start(),this.sendExistingEvents())}onBeforeUnload(){this.checkConnection()&&(this.pluginManager.onBeforeUnload(),this.userManager.isTracking()&&(this.userManager.incrementSession(),this.generateUserEngagement(),this.sendExistingEvents(!0)))}onFullScreenChange(e){this.checkConnection()&&e&&this.onFocus()}pauseAllSchedulers(){Object.keys(this.schedulers).forEach(e=>{this.schedulers[e]?.stop()})}onCallbackSessionTick(){this.userManager.incrementSession()}onCallbackAliveTimeout(){this.eventManager.addEvent(g.AL_CODE)}onCallbackCurrencyAccrual(){L.debug("Currency accrual timer tick"),this.eventManager.generateCurrencyAccrual()}onCallbackEventQueue(){this.generateUserEngagement(),this.processAndSendEvents()}setLevelWithValidation(e,t){this.validator.validLevel(t,e)&&(this.userManager.getLevel()!==e?(this.eventManager.generateCurrencyAccrual(),this.userManager.setLevel(e),this.remoteConfigManager&&this.remoteConfigManager.audienceState.updateAudienceState({level:e},!1),L.info('Level "{level}" is set successfully for user {user}',{level:this.userManager.getLevel(),user:this.userManager.getId()})):L.info("The current level is equal to the new level [{level}]",{level:e}))}setAppVersion(e,t){this.validator.validAppVer(e,t)&&(this.appManager.setAppVer(t),L.info('App version "{version}" is set successfully',{version:this.appManager.getAppVer()}))}userStartLifeCycle(){this.generateDeviceInfoForUser(),this.userManager.isTurnOnRef()&&(this.generateReferral(),this.eventManager.generateCurrencyAccrual()),this.startOrResumeSession(),Object.keys(this.schedulers).forEach(e=>{this.schedulers[e]?.reset()}),this.sendExistingEvents()}getCountEvents(){const e=this.eventManager?.getCountEventsByUser(this.userManager.getPrimaryId())||0,t=this.userManager.getCardChanges();return t&&Object.keys(t).length>0?e+1:e}sendExistingEvents(e=!1){this.getCountEvents()>0&&this.processAndSendEvents(e)}processAndSendEvents(e=!1){this.userManager.isTracking()&&this.eventManager.sendEvents(e),this.eventQueueManager.send()}startOrResumeSession(){const e=Date.now();this.userManager.getSessionId()&&e-this.userManager.getLastForeground()<this.appManager.getSessionTimeout()?(this.isNewSession=!1,this.userManager.resumeSession(),L.debug("Resume session {sessionId} for user {user}",{sessionId:this.userManager.getSessionId(),user:this.userManager.getId()})):(this.isNewSession=!0,this.userManager.getSessionLength()>0&&this.generateUserEngagement(),this.userManager.newSession(e),L.debug("Start new session {sessionId} for user {user}",{sessionId:this.userManager.getSessionId(),user:this.userManager.getId()}),this.eventManager.addEvent(g.SS_CODE),this.pluginManager.onSessionStart())}checkConnection(){if(!this.isConnected)throw"The SDK is not initialized yet!";return this.isConnected}trackingLifeCycle(e){const t=this.userManager.isTracking();e!==t&&(t?(this.timer.start(),this.configManagerSdk.clear(),this.configManagerSdk.start(),this.configManagerD2dId.clear(),this.configManagerD2dId.start(),this.autocapture.start()):(this.timer.stop(),this.autocapture.stop()))}reInitUser(e,t=null,s=!0){const r=this.userManager.isTracking();let i="User '{newName}' has been activated";if(this.progressionManager.clear(),e){const t=this.userManager.findUserByPrimaryId(e);this.userManager.init(t?.[G.userId]??null)}else i="User '{newName}' has been created",t=s?this.appManager.getUUID():t,this.userManager.create(t,s);L.info(i,{newName:this.userManager.getId()}),this.trackingLifeCycle(r),this.userManager.isTracking()&&(this.remoteConfigManager&&(this.configManagerD2dId.clear(),this.configManagerD2dId.start(),this.remoteConfigManager.changeUser()),this.userStartLifeCycle())}initialize(e,t,s,r=null,i){let n,o="";t.includes("_")?(o=t.split("_")[0]||"",n=t.split("_")[1]||""):o=t;const h=this.validator.validAppId(e,o),l="DTDAnalytics SDK is initialised with key '{appId}' and version '{ver}'",u={appId:h,ver:this.systemManager.getSdkVer()};if(void 0!==s?.[a]&&(L.setLogLevel(s[a]??E.INFO),delete s[a]),this.isConnected)throw"SDK is already initialized";if(this.systemManager.isBot()||this.systemManager.useXDR()){const e=this.systemManager.isBot()?l+"(Bot)":l+"(use XDomainRequest)";L.info(e,u)}else this.initSDK(h,n,s,i?.remoteConfigListener,i?.unityConfigListener),this.initUser(s||{}),this.remoteConfigManager&&this.remoteConfigManager.startAbTestLogic(),s?.autocapture&&this.autocapture.init(s.autocapture),this.isConnected=!0,this.eventListenersManager.start(),L.info(l,u),this.userManager.isTracking()?(this.timer.start(),this.configManagerSdk.start(),this.configManagerD2dId.start(),this.autocapture.start(),this.userStartLifeCycle(),this.pluginManager.start()):L.info("DTDAnalytics not active! Tracking status is Disable!",u),this.userManager.isUserCounting()&&this.userManager.setUserCounting(!1),x.isFunction(r)&&r()}registerPlugin(e){this.pluginManager.register(e)}unregisterPlugin(e){this.pluginManager.unregister(e)}getPlugin(e){return this.pluginManager.getPlugin(e)}setUserId(e,t){if(this.checkConnection()){const s=this.validator.validUserId(e,t),r=!s;let i="",n=!1;if(s||""===t)if(r&&this.userManager.isDefault())i="It's already default user!";else if(s===this.userManager.getId())i="The current userId is equal to the new userId [{user}]";else{n=!0;const e={newUser:r?"":s,oldUser:this.userManager.getId()};if(this.userManager.isDefault())this.userManager.replaceUserId(s,!1),L.info("User '{oldUser}' has been renamed to '{newUser}'",e);else{this.generateUserEngagement(),this.eventQueueManager.unfreeze(),this.sendExistingEvents();const t=r?{[G.isDefault]:!0}:{[G.userId]:s},i=this.storageManager.getUserModel().findPrimaryIdByCondition(t);L.info("The userId '{oldUser}' changed to '{newUser}'",e),this.reInitUser(i,s,r)}this.userManager.haveBackendId()&&!this.remoteConfigManager||(this.configManagerD2dId.clear(),this.configManagerD2dId.start())}else i="UserId is invalid",n=!1;if(!n)throw L.warning(i,{user:t}),i;this.pluginManager.onUserChange(t)}}replaceUserId(e,t,s){if(this.checkConnection()){const{prevId:r,id:i}=this.validator.validReplaceId(e,t,s);let n="The fromUserId is equal to the toUserId [{id}]!",a=!1,o={[G.userId]:r};x.isNullOrEmpty(r)&&(o={[G.isDefault]:!0});const h=this.userManager.getPrimaryIdByCondition(o),l=this.userManager.getPrimaryIdByCondition({[G.userId]:i});if(h===l);else if(x.isNullOrEmpty(h))n="The userId: [{prevId}] not found!";else{const e=this.userManager.getPrimaryId();h!=e?l==e?(this.reInitUser(h),this.userManager.replaceUserId(i,!1)):this.userManager.replaceUserIdForPrimaryUserId(h,i,!1):(this.userManager.replaceUserId(i,!1),this.generateDeviceInfoForUser()),x.isNullOrEmpty(l)||(this.eventManager.removeByPrimaryUserId(l),this.storageManager.getUserModel().removeUserByPrimaryId(l)),a=!0,n="User '{prevId}'renamed to '{id}'"}const u={prevId:r,id:i};if(!a)throw L.warning(n+" Replace not possible!",u),null;L.info(n,u),this.userManager.haveBackendId()&&!this.remoteConfigManager||(this.configManagerD2dId.clear(),this.configManagerD2dId.start())}}addEvent(e,t,s){this.checkConnection()&&(this.eventManager.addEvent(t,s||{},e),this.pluginManager.onEvent(t,s))}setTracking(e,t){if(this.checkConnection()&&this.validator.validTracking(e,t)){const e=this.userManager.isTracking();let s="Tracking status is already {status}";t!==e&&(this.eventManager.addEvent(g.TS_CODE,{allowed:t}),this.trackingLifeCycle(e),this.userManager.isTracking()&&(this.userStartLifeCycle(),this.eventManager.generatePeopleEvent(!0)),this.pluginManager.onTrackingChange(t),s="Tracking status is {status}"),L.info(s,{status:this.userManager.isTracking()?"Enable":"Disable"})}}setAppVer(e,t){if(this.checkConnection()){const s=this.appManager.getAppVer();this.setAppVersion(e,t),this.userManager.isTracking()&&s!=this.appManager.getAppVer()&&(this.configManagerSdk.clear(),this.configManagerSdk.start())}}setLevel(e,t){this.checkConnection()&&this.setLevelWithValidation(t,e)}sendEvents(){this.checkConnection()&&this.sendExistingEvents()}setUserCardField(e,t,s){if(this.checkConnection()){const{key:r,value:i}=this.validator.validUserCardEntry(s,e,t);if(null===r||null===i)return;const n=this.userManager.getCard();r===u?this.generateCheater(i):r===l?this.generateTester(i):void 0!==n[e]&&n[e]==i||(this.userManager.setCardField(r,i,s),L.info("[User Card] Value ["+i+"] for the key ["+r+"] was set successfully"),this.remoteConfigManager&&this.remoteConfigManager.audienceState.updateAudienceState({},!0))}}getUserCardField(e,t){if(this.checkConnection()){const s=this.validator.validUserCardKey(e,t);return s?this.userManager.getCardField(s):null}}unsetUserCardFields(e,t){this.checkConnection()&&(t=Array.isArray(t)?t:[t]).forEach(t=>{const s=this.validator.validUserCardKey(e,t,!1);if(s)switch(s){case u:this.generateCheater(!1);break;case l:this.generateTester(!1);break;default:this.userManager.unsetCardField(s)}})}clearUserCard(){this.checkConnection()&&(this.userManager.clearCard(),this.userManager.clearCardChanges(),L.info("All user data has been cleared successfully",{event:g.PL_CODE}),this.eventManager.addEvent(g.PL_CODE,{[c.PARAMETERS]:null}))}setCA(e,t,s,r,i){if(this.checkConnection()&&this.userManager.isTracking()){const n=this.validator.validCA(e,t,s,r,i,this.userManager.getCA());n&&this.userManager.setCA(n)}}startPe(e,t,s){if(this.checkConnection()){const{name:r,bundle:i}=this.validator.validStartPe(e,t,s);if(this.appManager.isAllExcluded())return void L.info("All events are excluded by project configuration");this.userManager.isTracking()&&this.progressionManager.start(r,i)}}stopPe(e,t,s){if(this.checkConnection()){const{name:r,parameters:i}=this.validator.validStopPe(e,t,s);if(this.appManager.isAllExcluded())return void L.info("All events are excluded by project configuration");if(!this.validator.isExcluded(this.appManager.getEventsExcluded(),g.PE_CODE,i)){const t=this.progressionManager.finish(r,i);t&&this.eventManager.addEvent(g.PE_CODE,t,e)}}}applyRemoteConfig(){this.checkConnection()&&(this.remoteConfigManager?this.remoteConfigManager.applyConfig():L.error("The SDK is initialized without the AB tests!"))}resetRemoteConfig(){this.checkConnection()&&(this.remoteConfigManager?this.remoteConfigManager.resetConfig():L.error("The SDK is initialized without the AB tests!"))}invalidateRemoteConfig(){this.checkConnection()&&(this.remoteConfigManager?this.remoteConfigManager.invalidateConfig():L.error("The SDK is initialized without the AB tests!"))}close(){this.isConnected=!1,this.autocapture&&this.autocapture.stop(),this.pluginManager&&this.pluginManager.stop()}setCallbackDId(e){if(this.systemManager.setCallbackDId(e),this.checkConnection()){const t=this.userManager.getD2dId();x.isNullOrEmpty(t)||x.isNullOrEmpty(e)||e(t)}}setSDKVer(e,t){this.validator.validAppVer(e,t)&&(this.systemManager.setSdkVer(t),L.info('SDK version "{val}" is set successfully',{val:this.systemManager.getSdkVer()}))}setSDKVerCode(e,t){this.validator.validSdkVerCode(e,t)&&(this.systemManager.setSdkVerCode(t),L.info('SDK version code "{val}" is set successfully',{val:this.systemManager.getSdkVerCode()}))}getUser(){return this.userManager}getApp(){return this.appManager}getIsInitialized(){return this.isConnected}getter(e){if(this.checkConnection())switch(e){case"appVer":return this.appManager.getAppVer();case"userId":return this.userManager.getId();case"level":return this.userManager.getLevel();case"tracking":return this.userManager.isTracking();case"deviceId":return this.userManager.getDeviceId();case"sdkVer":return this.systemManager.getSdkVer();default:return null}return null}}class Dt extends Me{constructor(e){super(e),je.add(this),$e.set(this,void 0),t(this,$e,e,"f")}migrationUser(t,s){try{if(void 0!==t&&void 0!==s){const r=JSON.parse(s);let i,n;void 0!==r.deviceId&&(i=r.deviceId),void 0!==r.userId&&(n=r.userId);const a=e(this,je,"m",Qe).call(this,n,i);e(this,je,"m",Je).call(this,t,n||"",a,0,r)}}catch(e){L.error("Migration user failed",{method:"migrationUser",error:e})}}migrationDevice(t,s){try{if(void 0!==t&&void 0!==s){const r=JSON.parse(s);let i,n;void 0!==r.deviceId&&(i=r.deviceId),void 0!==r.userId&&(n=r.userId);const a=e(this,je,"m",Qe).call(this,n,i),o={...r};delete o.prevUserId,e(this,je,"m",Je).call(this,t,i||"",a,1,o)}}catch(e){L.error("Migration device failed",{method:"migrationDevice",error:e})}}setSDKVersion(t){const s="setSDKVersion";try{e(this,$e,"f").setSDKVer(s,t)}catch(e){L.error("Set SDK version failed",{method:s,error:e})}}setSdkCodeVersion(t){const s="setSdkCodeVersion";try{e(this,$e,"f").setSDKVerCode(s,t)}catch(e){L.error("Set SDK code version failed",{method:s,error:e})}}close(){e(this,$e,"f").close()}getClient(){return e(this,$e,"f")}getConfigJson(){return le.config.values}setCountingTypeListener(t){e(this,$e,"f").systemManager.setCountingTypeCallback(t)}getLoggerInstance(){return L}}$e=new WeakMap,je=new WeakSet,Ye=function(e,t){null!==e&&(e instanceof Error?L.error(e.message,{method:t}):L.error(e,{method:t})),L.error("Execution of the {method} method was canceled!",{method:t})},Qe=function(e,t){return void 0===e||""===e||t===e},Je=function(t,s,r,i,n){try{e(this,$e,"f").initialize("migration",t,n);const a=e(this,$e,"f").storageManager,o=a.getAppModel(),h=a.getUserModel();if(o.isMigration())L.warning("Already migration");else{const e=a.getUserModel().findPrimaryIdByCondition({[G.userId]:s});if(x.isNullOrEmpty(e)){h.create(s,r);const e={[G.userCounting]:!!i},t={[j.isMigration]:1};for(const s in n)if(!x.isNullOrEmpty(n[s]))switch(s){case"prevUserId":e[G.prevUserId]=n[s],e[G.prevDeviceId]=n[s];break;case"trackingAvailable":e[G.tracking]=n[s];break;case"level":e[G.currentLevel]=n[s];break;case"userCard":e[G.profile]=n[s];break;case"tutorCompletedSteps":e[G.tutorialSteps]=n[s];break;case"transactionIds":t[j.transactionIds]=n[s]}h.setAttrs(e),o.setAttrs(t)}else L.warning("User not empty")}}catch(t){L.error("Migration failed",{error:t}),e(this,je,"m",Ye).call(this,t,"migration")}};class Ut extends Dt{constructor(s){const r=new kt;super(r),Xe.add(this),Ze.set(this,void 0),t(this,Ze,r,"f"),s&&e(this,Ze,"f").systemManager.setEnv(s)}initialize(t,s){const r="Initialize";try{if(!e(this,Ze,"f"))throw new Error("Analytics is not initialized");e(this,Ze,"f").initialize(r,t,s,Me.onInitCallback)}catch(t){e(this,Xe,"m",et).call(this,t,r)}}initializeWithRemoteConfig(t,s,r,i){const n="initializeWithRemoteConfig";try{if(!e(this,Ze,"f"))throw new Error("Analytics is not initialized");e(this,Ze,"f").initialize(n,t,s,Me.onInitCallback,{remoteConfigListener:r,unityConfigListener:i})}catch(t){e(this,Xe,"m",et).call(this,t,n)}}}Ze=new WeakMap,Xe=new WeakSet,et=function(e,t){null!==e&&(e instanceof Error?L.error(e.message,{method:t}):L.error(e,{method:t})),L.error("Execution of the {method} method was canceled!",{method:t})},"undefined"!=typeof window&&(window.devtodev=new Ut({engine:"Unity"}))}();
